import{v as h}from"./chunk-5YR763VN.js";import{a as ee}from"./chunk-7BCPLMA2.js";import{a as Y}from"./chunk-PDXBIG4C.js";import{i as H}from"./chunk-LIFXJ7WC.js";import{A as J,B as X,b as G,e as z,j as B,k as j,o as W,r as Q,u as q}from"./chunk-CKKTX6AT.js";import"./chunk-MOL5OWPJ.js";import{Ab as N,B as w,Dc as R,Ea as E,Fa as V,Ga as A,Ic as v,Jc as y,Kb as u,Ob as f,R as I,Tb as _,Yb as s,Zb as i,_b as d,a as M,b as k,cc as $,da as L,ea as Z,fc as T,ha as K,hc as x,ob as a,od as D,qa as b,sc as U,tc as P,ua as O,vc as c,wc as m,xc as F}from"./chunk-UVO63754.js";var ne=["indexedChart"],ie=["keywordsChart"];function ae(o,t){if(o&1){let e=$();s(0,"div",13),d(1,"canvas",17,0),i(),s(3,"button",18),T("click",function(){E(e);let p=x();return V(p.resetIndexedZoom())}),c(4),i()}if(o&2){let e=t,n=x();a(),f("type",e.chart.type)("datasets",e.chart.data.datasets)("labels",e.chart.data.labels)("options",e.chart.options),a(3),F(" ",n.lang.locals.reset_zoom," ")}}function oe(o,t){o&1&&d(0,"div",19)(1,"div",20)}function re(o,t){if(o&1){let e=$();s(0,"div",13),d(1,"canvas",17,1),i(),s(3,"button",18),T("click",function(){E(e);let p=x();return V(p.resetKeywordsZoom())}),c(4),i()}if(o&2){let e=t,n=x();a(),f("type",e.chart.type)("datasets",e.chart.data.datasets)("labels",e.chart.data.labels)("options",e.chart.options),a(3),F(" ",n.lang.locals.reset_zoom," ")}}function se(o,t){o&1&&d(0,"div",19)(1,"div",20)}function le(o,t){if(o&1&&(s(0,"div",13),d(1,"canvas",17,1),i()),o&2){let e=t;a(),f("type",e.chart.type)("datasets",e.chart.data.datasets)("labels",e.chart.data.labels)("options",e.chart.options)}}function de(o,t){o&1&&d(0,"div",19)(1,"div",20)}function ce(o,t){o&1&&(s(0,"p",21),c(1),i(),A(),s(2,"svg",22),d(3,"g",23)(4,"g",24),s(5,"g",25),d(6,"path",26)(7,"path",27)(8,"path",28)(9,"path",29),i()()),o&2&&(a(),m(t))}function me(o,t){o&1&&d(0,"div",16)}var te=class o{lang=b(G);adminService=b(Y);crawlingService=b(ee);fb=b(J);reportCount$=this.adminService.getReportsCount();urlCount$=this.adminService.getUrlsCount();mostIndexedChart=N("indexedChart",{read:h});mostUsedKeywordsChart=N("keywordsChart",{read:h});indexedForm=this.fb.group({from_date:[""],to_date:[""]},{validators:H([["from_date","to_date"]],["DateInvalidRangeIndexed"])});keywordsForm=this.fb.group({from_date:[""],to_date:[""]},{validators:H([["from_date","to_date"]],["DateInvalidRangeKeyword"])});numberOfIndexedNews$=this.crawlingService.getTotalNumberOfIndexedNews().pipe(K(console.log));newsPercentage$=this.crawlingService.getIndexedNewsPercentage().pipe(w(t=>({title:this.lang.locals.indexed_sources_percentage,chart:this.getNewsPercentageChartConfig(t)})));mostIndexedUrl$=this.indexedForm.valueChanges.pipe(L(this.indexedForm.value),I(300),Z(({from_date:t,to_date:e})=>this.crawlingService.getMostIndexedStatistics(t,e)),w(t=>({title:this.lang.locals.most_indexed_urls,chart:this.getChartConfig(t)})));mostUsedKeywords$=this.keywordsForm.valueChanges.pipe(L(this.keywordsForm.value),I(300),Z(({from_date:t,to_date:e})=>this.crawlingService.getMostUsedKeywordStatistics(t,e)),w(t=>({title:this.lang.locals.most_used_keywords,chart:this.getKeywordChartConfig(t)})));getChartConfig(t){let e=new Map;t.forEach(r=>{let l=decodeURIComponent(r.Most_indexed_URL),S=r.IndexDate,C=e.get(l)||{count:0,dates:new Set};C.count+=r.Count,C.dates.add(S),e.set(l,C)});let n=Array.from(e.entries()).sort((r,l)=>r[1].count-l[1].count),p=n.map(([r,l])=>`${r} (${Array.from(l.dates).join(", ")})`),g=n.map(r=>r[1].count);return{type:"bar",data:{labels:p,datasets:[{label:this.lang.locals.links_count,data:g,backgroundColor:"rgba(138, 21, 56, 0.5)",borderColor:"rgba(138, 21, 56)",borderWidth:2}]},options:this.getChartOptions()}}getKeywordChartConfig(t){let e=new Map;t.forEach(r=>{let l=r["Most-used-keywords"].trim(),S=r.IndexDate,C=e.get(l)||{count:0,dates:new Set};C.count+=r.Count,C.dates.add(S),e.set(l,C)});let n=Array.from(e.entries()).sort((r,l)=>r[1].count-l[1].count),p=n.map(([r,l])=>`${r} (${Array.from(l.dates).join(", ")})`),g=n.map(r=>r[1].count);return{type:"bar",data:{labels:p,datasets:[{label:this.lang.locals.keywords_count,data:g,backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235)",borderWidth:2}]},options:this.getChartOptions()}}getNewsPercentageChartConfig(t){let e=Object.values(t);return{type:"pie",data:{labels:Object.keys(t),datasets:[{label:this.lang.locals.indexed_sources_percentage,data:e}]},options:this.getNewsPercentageChartOptions()}}getNewsPercentageChartOptions(){return k(M({},this.getChartOptions()),{plugins:{legend:{display:!0,position:"top"},tooltip:k(M({},this.getChartOptions().plugins.tooltip),{callbacks:{title:()=>this.lang.locals.keywords,label:t=>[`${t.label||""}:${t.raw}%`]}}),datalabels:{textAlign:"center",color:"#ffffff",font:{size:14},backgroundColor:t=>t.dataset.backgroundColor[t.dataIndex],borderColor:"#ffffff",borderRadius:8,borderWidth:1,padding:{left:10,right:10},display:t=>!!t.dataset.data[t.dataIndex],formatter:(t,e)=>[e.chart.data.labels[e.dataIndex],`${t}%`]}},scales:void 0})}getChartOptions(){return{responsive:!0,indexAxis:"y",plugins:{legend:{display:!0},tooltip:{rtl:this.lang.currentLanguage==="ar"},zoom:{zoom:{wheel:{enabled:!0},drag:{enabled:!0},pinch:{enabled:!0},mode:"xy"},pan:{enabled:!0,mode:"xy"},limits:{x:{min:0,max:100},y:{min:0,max:100}}}},scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:12}}}}}}resetIndexedZoom(){this.mostIndexedChart()?.chart?.resetZoom()}resetKeywordsZoom(){this.mostUsedKeywordsChart()?.chart?.resetZoom()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["app-statistics"]],viewQuery:function(e,n){e&1&&(U(n.mostIndexedChart,ne,5,h),U(n.mostUsedKeywordsChart,ie,5,h)),e&2&&P(2)},standalone:!0,features:[R],decls:48,vars:24,consts:[["indexedChart",""],["keywordsChart",""],[1,"w-full","mx-auto","p-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"col-span-1","p-8","bg-white","rounded-2xl","shadow-lg","border","border-gray-200"],[1,"text-2xl","font-semibold","text-gray-700","mb-1"],[1,"text-xs","text-gray-500","mb-3"],[1,"flex","flex-col","md:flex-row","gap-4","mb-4","text-gray-700",3,"formGroup"],[1,"flex","flex-col","flex-auto"],["for","from_date",1,"text-sm","font-medium"],["type","date","formControlName","from_date",1,"rounded-md","p-2","border-2","border-gray-300","outline-none","focus:border-primary"],["for","to_date",1,"text-sm","font-medium"],["type","date","formControlName","to_date",1,"rounded-md","p-2","border-2","border-gray-300","outline-none","focus:border-primary"],[2,"display","block"],[1,"relative","overflow-hidden","h-28","p-6","bg-white","border","border-gray-200","rounded-2xl","shadow-md","hover:shadow-lg","transition"],[1,"text-gray-700","text-2xl","font-semibold"],[1,"h-10","bg-gray-300","rounded","animate-pulse","mt-2"],["baseChart","",1,"max-h-56",3,"type","datasets","labels","options"],[1,"mt-2","text-sm","text-blue-500","hover:underline",3,"click"],[1,"h-10","bg-gray-300","rounded","animate-pulse","mb-4"],[1,"h-56","bg-gray-300","rounded","animate-pulse"],[1,"text-gray-900","text-4xl","font-bold","mt-2"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"absolute","w-40","h-32","top-0","rtl:left-0","right-0","m-2","opacity-50","mr-auto"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M6 14.5H14","stroke","#bfbfbf","stroke-width","1.5","stroke-linecap","round"],["d","M6 18H11.5","stroke","#bfbfbf","stroke-width","1.5","stroke-linecap","round"],["d","M13 2.5V5C13 7.35702 13 8.53553 13.7322 9.26777C14.4645 10 15.643 10 18 10H22","stroke","#bfbfbf","stroke-width","1.5"],["d","M2.75 10C2.75 9.58579 2.41421 9.25 2 9.25C1.58579 9.25 1.25 9.58579 1.25 10H2.75ZM21.25 14C21.25 14.4142 21.5858 14.75 22 14.75C22.4142 14.75 22.75 14.4142 22.75 14H21.25ZM15.3929 4.05365L14.8912 4.61112L15.3929 4.05365ZM19.3517 7.61654L18.85 8.17402L19.3517 7.61654ZM21.654 10.1541L20.9689 10.4592V10.4592L21.654 10.1541ZM3.17157 20.8284L3.7019 20.2981H3.7019L3.17157 20.8284ZM20.8284 20.8284L20.2981 20.2981L20.2981 20.2981L20.8284 20.8284ZM1.35509 5.92658C1.31455 6.33881 1.61585 6.70585 2.02807 6.7464C2.4403 6.78695 2.80734 6.48564 2.84789 6.07342L1.35509 5.92658ZM22.6449 18.0734C22.6855 17.6612 22.3841 17.2941 21.9719 17.2536C21.5597 17.2131 21.1927 17.5144 21.1521 17.9266L22.6449 18.0734ZM14 21.25H10V22.75H14V21.25ZM2.75 14V10H1.25V14H2.75ZM21.25 13.5629V14H22.75V13.5629H21.25ZM14.8912 4.61112L18.85 8.17402L19.8534 7.05907L15.8947 3.49618L14.8912 4.61112ZM22.75 13.5629C22.75 11.8745 22.7651 10.8055 22.3391 9.84897L20.9689 10.4592C21.2349 11.0565 21.25 11.742 21.25 13.5629H22.75ZM18.85 8.17402C20.2034 9.3921 20.7029 9.86199 20.9689 10.4592L22.3391 9.84897C21.9131 8.89241 21.1084 8.18853 19.8534 7.05907L18.85 8.17402ZM10.0298 2.75C11.6116 2.75 12.2085 2.76158 12.7405 2.96573L13.2779 1.5653C12.4261 1.23842 11.498 1.25 10.0298 1.25V2.75ZM15.8947 3.49618C14.8087 2.51878 14.1297 1.89214 13.2779 1.5653L12.7405 2.96573C13.2727 3.16993 13.7215 3.55836 14.8912 4.61112L15.8947 3.49618ZM10 21.25C8.09318 21.25 6.73851 21.2484 5.71085 21.1102C4.70476 20.975 4.12511 20.7213 3.7019 20.2981L2.64124 21.3588C3.38961 22.1071 4.33855 22.4392 5.51098 22.5969C6.66182 22.7516 8.13558 22.75 10 22.75V21.25ZM1.25 14C1.25 15.8644 1.24841 17.3382 1.40313 18.489C1.56076 19.6614 1.89288 20.6104 2.64124 21.3588L3.7019 20.2981C3.27869 19.8749 3.02502 19.2952 2.88976 18.2892C2.75159 17.2615 2.75 15.9068 2.75 14H1.25ZM14 22.75C15.8644 22.75 17.3382 22.7516 18.489 22.5969C19.6614 22.4392 20.6104 22.1071 21.3588 21.3588L20.2981 20.2981C19.8749 20.7213 19.2952 20.975 18.2892 21.1102C17.2615 21.2484 15.9068 21.25 14 21.25V22.75ZM10.0298 1.25C8.15538 1.25 6.67442 1.24842 5.51887 1.40307C4.34232 1.56054 3.39019 1.8923 2.64124 2.64124L3.7019 3.7019C4.12453 3.27928 4.70596 3.02525 5.71785 2.88982C6.75075 2.75158 8.11311 2.75 10.0298 2.75V1.25ZM2.84789 6.07342C2.96931 4.83905 3.23045 4.17335 3.7019 3.7019L2.64124 2.64124C1.80633 3.47616 1.48944 4.56072 1.35509 5.92658L2.84789 6.07342ZM21.1521 17.9266C21.0307 19.1609 20.7695 19.8266 20.2981 20.2981L21.3588 21.3588C22.1937 20.5238 22.5106 19.4393 22.6449 18.0734L21.1521 17.9266Z","fill","#bfbfbf"]],template:function(e,n){if(e&1&&(s(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),c(4),i(),s(5,"p",6),c(6),i(),s(7,"form",7)(8,"div",8)(9,"label",9),c(10),i(),d(11,"input",10),i(),s(12,"div",8)(13,"label",11),c(14),i(),d(15,"input",12),i()(),u(16,ae,5,5),v(17,"async"),u(18,oe,2,0),i(),s(19,"div",4)(20,"h2",5),c(21),i(),s(22,"p",6),c(23),i(),s(24,"form",7)(25,"div",8)(26,"label",9),c(27),i(),d(28,"input",10),i(),s(29,"div",8)(30,"label",11),c(31),i(),d(32,"input",12),i()(),u(33,re,5,5),v(34,"async"),u(35,se,2,0),i(),s(36,"div",4)(37,"h2",5),c(38),i(),u(39,le,3,4,"div",13),v(40,"async"),u(41,de,2,0),i(),s(42,"div",14)(43,"h2",15),c(44),i(),u(45,ce,10,1),v(46,"async"),u(47,me,1,0,"div",16),i()()()),e&2){let p,g,r,l;a(4),m(n.lang.locals.most_indexed_urls),a(2),m(n.lang.locals.chart_zoom_tip),a(),f("formGroup",n.indexedForm),a(3),m(n.lang.locals.start_time),a(4),m(n.lang.locals.end_time),a(2),_((p=y(17,16,n.mostIndexedUrl$))?16:18,p),a(5),m(n.lang.locals.most_used_keywords),a(2),m(n.lang.locals.chart_zoom_tip),a(),f("formGroup",n.keywordsForm),a(3),m(n.lang.locals.start_time),a(4),m(n.lang.locals.end_time),a(2),_((g=y(34,18,n.mostUsedKeywords$))?33:35,g),a(5),m(n.lang.locals.indexed_sources_percentage),a(),_((r=y(40,20,n.newsPercentage$))?39:41,r),a(5),m(n.lang.locals.total_indexed_news),a(),_((l=y(46,22,n.numberOfIndexedNews$))?45:47,l)}},dependencies:[D,h,X,W,z,B,j,Q,q],encapsulation:2})};export{te as StatisticsComponent};
