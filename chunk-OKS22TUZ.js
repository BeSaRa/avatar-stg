import{a as gn}from"./chunk-NDL6VD3Y.js";import{a as pn,b as fn}from"./chunk-L2OPFK6C.js";import{a as an}from"./chunk-2MHWPFOM.js";import{a as on}from"./chunk-VI7I75JN.js";import{a as hn}from"./chunk-FDUHK4JZ.js";import{a as cn}from"./chunk-4I6XGE32.js";import"./chunk-27NONHNX.js";import{c as ln}from"./chunk-DEUCULCI.js";import{a as vi}from"./chunk-I6674MYI.js";import{a as dn}from"./chunk-IA6SH5H3.js";import{b as Xt}from"./chunk-LQAATZVK.js";import{a as en,b as tn}from"./chunk-Z3K2Z3BL.js";import{c as Yt,f as Gt}from"./chunk-3B3WBCR2.js";import"./chunk-FWDT53KA.js";import{a as un}from"./chunk-3HIEYE76.js";import"./chunk-NBFOU5XV.js";import"./chunk-QDK5XKTO.js";import{a as sn}from"./chunk-6BC4QFZY.js";import{b as nn,c as rn}from"./chunk-46G4OXLF.js";import{D as Zt}from"./chunk-RCUMT5X2.js";import"./chunk-OK5S6IU3.js";import{b as Te}from"./chunk-FEAJVVOQ.js";import{b as Wt}from"./chunk-JZHZ6J63.js";import"./chunk-6RRUKESK.js";import{Ab as W,B as Se,Da as Rt,Dc as _e,Ea as _,Fa as T,Fb as Pt,Fc as Ge,Ga as le,Gc as Ut,Ha as Ee,Hc as We,Ia as Mt,Ic as Ze,Jc as Ft,Ka as Lt,Kb as Z,Kc as Ot,M as xt,N as Fe,Na as Bt,Ob as m,P as At,Rb as be,Sb as Nt,T as Oe,Tb as M,Ub as kt,V as It,Wb as Ke,X as $e,Xb as Je,Yb as h,Yc as $t,Zb as g,_b as v,_c as Qt,cc as de,e as f,ea as $,f as Tt,fa as ae,fc as x,ha as Q,hc as b,i as se,ib as Qe,jb as H,ld as jt,ob as c,oc as qt,od as Kt,pb as je,pc as Ht,q as De,qa as V,qc as zt,rd as Jt,s as Ue,sc as X,tc as Dt,ua as ye,uc as Ye,vb as Vt,vc as E,w as ve,wc as z,xc as P,zb as ce}from"./chunk-UVO63754.js";var wn=f((qr,mn)=>{"use strict";mn.exports=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}});var D=f(j=>{"use strict";var Xe,Si=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];j.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};j.getSymbolTotalCodewords=function(e){return Si[e]};j.getBCHDigit=function(i){let e=0;for(;i!==0;)e++,i>>>=1;return e};j.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');Xe=e};j.isKanjiModeEnabled=function(){return typeof Xe<"u"};j.toSJIS=function(e){return Xe(e)}});var xe=f(A=>{"use strict";A.L={bit:1};A.M={bit:0};A.Q={bit:3};A.H={bit:2};function yi(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"l":case"low":return A.L;case"m":case"medium":return A.M;case"q":case"quartile":return A.Q;case"h":case"high":return A.H;default:throw new Error("Unknown EC Level: "+i)}}A.isValid=function(e){return e&&typeof e.bit<"u"&&e.bit>=0&&e.bit<4};A.from=function(e,t){if(A.isValid(e))return e;try{return yi(e)}catch{return t}}});var Sn=f((Dr,vn)=>{"use strict";function Cn(){this.buffer=[],this.length=0}Cn.prototype={get:function(i){let e=Math.floor(i/8);return(this.buffer[e]>>>7-i%8&1)===1},put:function(i,e){for(let t=0;t<e;t++)this.putBit((i>>>e-t-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(i){let e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),i&&(this.buffer[e]|=128>>>this.length%8),this.length++}};vn.exports=Cn});var En=f((Ur,yn)=>{"use strict";function ue(i){if(!i||i<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=i,this.data=new Uint8Array(i*i),this.reservedBit=new Uint8Array(i*i)}ue.prototype.set=function(i,e,t,n){let r=i*this.size+e;this.data[r]=t,n&&(this.reservedBit[r]=!0)};ue.prototype.get=function(i,e){return this.data[i*this.size+e]};ue.prototype.xor=function(i,e,t){this.data[i*this.size+e]^=t};ue.prototype.isReserved=function(i,e){return this.reservedBit[i*this.size+e]};yn.exports=ue});var bn=f(Ae=>{"use strict";var Ei=D().getSymbolSize;Ae.getRowColCoords=function(e){if(e===1)return[];let t=Math.floor(e/7)+2,n=Ei(e),r=n===145?26:Math.ceil((n-13)/(2*t-2))*2,o=[n-7];for(let s=1;s<t-1;s++)o[s]=o[s-1]-r;return o.push(6),o.reverse()};Ae.getPositions=function(e){let t=[],n=Ae.getRowColCoords(e),r=n.length;for(let o=0;o<r;o++)for(let s=0;s<r;s++)o===0&&s===0||o===0&&s===r-1||o===r-1&&s===0||t.push([n[o],n[s]]);return t}});var xn=f(Tn=>{"use strict";var bi=D().getSymbolSize,_n=7;Tn.getPositions=function(e){let t=bi(e);return[[0,0],[t-_n,0],[0,t-_n]]}});var An=f(w=>{"use strict";w.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var K={N1:3,N2:3,N3:40,N4:10};w.isValid=function(e){return e!=null&&e!==""&&!isNaN(e)&&e>=0&&e<=7};w.from=function(e){return w.isValid(e)?parseInt(e,10):void 0};w.getPenaltyN1=function(e){let t=e.size,n=0,r=0,o=0,s=null,a=null;for(let l=0;l<t;l++){r=o=0,s=a=null;for(let d=0;d<t;d++){let u=e.get(l,d);u===s?r++:(r>=5&&(n+=K.N1+(r-5)),s=u,r=1),u=e.get(d,l),u===a?o++:(o>=5&&(n+=K.N1+(o-5)),a=u,o=1)}r>=5&&(n+=K.N1+(r-5)),o>=5&&(n+=K.N1+(o-5))}return n};w.getPenaltyN2=function(e){let t=e.size,n=0;for(let r=0;r<t-1;r++)for(let o=0;o<t-1;o++){let s=e.get(r,o)+e.get(r,o+1)+e.get(r+1,o)+e.get(r+1,o+1);(s===4||s===0)&&n++}return n*K.N2};w.getPenaltyN3=function(e){let t=e.size,n=0,r=0,o=0;for(let s=0;s<t;s++){r=o=0;for(let a=0;a<t;a++)r=r<<1&2047|e.get(s,a),a>=10&&(r===1488||r===93)&&n++,o=o<<1&2047|e.get(a,s),a>=10&&(o===1488||o===93)&&n++}return n*K.N3};w.getPenaltyN4=function(e){let t=0,n=e.data.length;for(let o=0;o<n;o++)t+=e.data[o];return Math.abs(Math.ceil(t*100/n/5)-10)*K.N4};function _i(i,e,t){switch(i){case w.Patterns.PATTERN000:return(e+t)%2===0;case w.Patterns.PATTERN001:return e%2===0;case w.Patterns.PATTERN010:return t%3===0;case w.Patterns.PATTERN011:return(e+t)%3===0;case w.Patterns.PATTERN100:return(Math.floor(e/2)+Math.floor(t/3))%2===0;case w.Patterns.PATTERN101:return e*t%2+e*t%3===0;case w.Patterns.PATTERN110:return(e*t%2+e*t%3)%2===0;case w.Patterns.PATTERN111:return(e*t%3+(e+t)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}w.applyMask=function(e,t){let n=t.size;for(let r=0;r<n;r++)for(let o=0;o<n;o++)t.isReserved(o,r)||t.xor(o,r,_i(e,o,r))};w.getBestMask=function(e,t){let n=Object.keys(w.Patterns).length,r=0,o=1/0;for(let s=0;s<n;s++){t(s),w.applyMask(s,e);let a=w.getPenaltyN1(e)+w.getPenaltyN2(e)+w.getPenaltyN3(e)+w.getPenaltyN4(e);w.applyMask(s,e),a<o&&(o=a,r=s)}return r}});var tt=f(et=>{"use strict";var U=xe(),Ie=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],Re=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];et.getBlocksCount=function(e,t){switch(t){case U.L:return Ie[(e-1)*4+0];case U.M:return Ie[(e-1)*4+1];case U.Q:return Ie[(e-1)*4+2];case U.H:return Ie[(e-1)*4+3];default:return}};et.getTotalCodewordsCount=function(e,t){switch(t){case U.L:return Re[(e-1)*4+0];case U.M:return Re[(e-1)*4+1];case U.Q:return Re[(e-1)*4+2];case U.H:return Re[(e-1)*4+3];default:return}}});var In=f(Le=>{"use strict";var he=new Uint8Array(512),Me=new Uint8Array(256);(function(){let e=1;for(let t=0;t<255;t++)he[t]=e,Me[e]=t,e<<=1,e&256&&(e^=285);for(let t=255;t<512;t++)he[t]=he[t-255]})();Le.log=function(e){if(e<1)throw new Error("log("+e+")");return Me[e]};Le.exp=function(e){return he[e]};Le.mul=function(e,t){return e===0||t===0?0:he[Me[e]+Me[t]]}});var Rn=f(ge=>{"use strict";var nt=In();ge.mul=function(e,t){let n=new Uint8Array(e.length+t.length-1);for(let r=0;r<e.length;r++)for(let o=0;o<t.length;o++)n[r+o]^=nt.mul(e[r],t[o]);return n};ge.mod=function(e,t){let n=new Uint8Array(e);for(;n.length-t.length>=0;){let r=n[0];for(let s=0;s<t.length;s++)n[s]^=nt.mul(t[s],r);let o=0;for(;o<n.length&&n[o]===0;)o++;n=n.slice(o)}return n};ge.generateECPolynomial=function(e){let t=new Uint8Array([1]);for(let n=0;n<e;n++)t=ge.mul(t,new Uint8Array([1,nt.exp(n)]));return t}});var Bn=f((Jr,Ln)=>{"use strict";var Mn=Rn();function it(i){this.genPoly=void 0,this.degree=i,this.degree&&this.initialize(this.degree)}it.prototype.initialize=function(e){this.degree=e,this.genPoly=Mn.generateECPolynomial(this.degree)};it.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");let t=new Uint8Array(e.length+this.degree);t.set(e);let n=Mn.mod(t,this.genPoly),r=this.degree-n.length;if(r>0){let o=new Uint8Array(this.degree);return o.set(n,r),o}return n};Ln.exports=it});var rt=f(Vn=>{"use strict";Vn.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}});var ot=f(N=>{"use strict";var Pn="[0-9]+",Ti="[A-Z $%*+\\-./:]+",pe="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";pe=pe.replace(/u/g,"\\u");var xi="(?:(?![A-Z0-9 $%*+\\-./:]|"+pe+`)(?:.|[\r
]))+`;N.KANJI=new RegExp(pe,"g");N.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");N.BYTE=new RegExp(xi,"g");N.NUMERIC=new RegExp(Pn,"g");N.ALPHANUMERIC=new RegExp(Ti,"g");var Ai=new RegExp("^"+pe+"$"),Ii=new RegExp("^"+Pn+"$"),Ri=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");N.testKanji=function(e){return Ai.test(e)};N.testNumeric=function(e){return Ii.test(e)};N.testAlphanumeric=function(e){return Ri.test(e)}});var F=f(S=>{"use strict";var Mi=rt(),st=ot();S.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]};S.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]};S.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]};S.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]};S.MIXED={bit:-1};S.getCharCountIndicator=function(e,t){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!Mi.isValid(t))throw new Error("Invalid version: "+t);return t>=1&&t<10?e.ccBits[0]:t<27?e.ccBits[1]:e.ccBits[2]};S.getBestModeForData=function(e){return st.testNumeric(e)?S.NUMERIC:st.testAlphanumeric(e)?S.ALPHANUMERIC:st.testKanji(e)?S.KANJI:S.BYTE};S.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")};S.isValid=function(e){return e&&e.bit&&e.ccBits};function Li(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return S.NUMERIC;case"alphanumeric":return S.ALPHANUMERIC;case"kanji":return S.KANJI;case"byte":return S.BYTE;default:throw new Error("Unknown mode: "+i)}}S.from=function(e,t){if(S.isValid(e))return e;try{return Li(e)}catch{return t}}});var zn=f(J=>{"use strict";var Be=D(),Bi=tt(),Nn=xe(),O=F(),at=rt(),qn=7973,kn=Be.getBCHDigit(qn);function Vi(i,e,t){for(let n=1;n<=40;n++)if(e<=J.getCapacity(n,t,i))return n}function Hn(i,e){return O.getCharCountIndicator(i,e)+4}function Pi(i,e){let t=0;return i.forEach(function(n){let r=Hn(n.mode,e);t+=r+n.getBitsLength()}),t}function Ni(i,e){for(let t=1;t<=40;t++)if(Pi(i,t)<=J.getCapacity(t,e,O.MIXED))return t}J.from=function(e,t){return at.isValid(e)?parseInt(e,10):t};J.getCapacity=function(e,t,n){if(!at.isValid(e))throw new Error("Invalid QR Code version");typeof n>"u"&&(n=O.BYTE);let r=Be.getSymbolTotalCodewords(e),o=Bi.getTotalCodewordsCount(e,t),s=(r-o)*8;if(n===O.MIXED)return s;let a=s-Hn(n,e);switch(n){case O.NUMERIC:return Math.floor(a/10*3);case O.ALPHANUMERIC:return Math.floor(a/11*2);case O.KANJI:return Math.floor(a/13);case O.BYTE:default:return Math.floor(a/8)}};J.getBestVersionForData=function(e,t){let n,r=Nn.from(t,Nn.M);if(Array.isArray(e)){if(e.length>1)return Ni(e,r);if(e.length===0)return 1;n=e[0]}else n=e;return Vi(n.mode,n.getLength(),r)};J.getEncodedBits=function(e){if(!at.isValid(e)||e<7)throw new Error("Invalid QR Code version");let t=e<<12;for(;Be.getBCHDigit(t)-kn>=0;)t^=qn<<Be.getBCHDigit(t)-kn;return e<<12|t}});var On=f(Fn=>{"use strict";var lt=D(),Un=1335,ki=21522,Dn=lt.getBCHDigit(Un);Fn.getEncodedBits=function(e,t){let n=e.bit<<3|t,r=n<<10;for(;lt.getBCHDigit(r)-Dn>=0;)r^=Un<<lt.getBCHDigit(r)-Dn;return(n<<10|r)^ki}});var Qn=f((eo,$n)=>{"use strict";var qi=F();function ee(i){this.mode=qi.NUMERIC,this.data=i.toString()}ee.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};ee.prototype.getLength=function(){return this.data.length};ee.prototype.getBitsLength=function(){return ee.getBitsLength(this.data.length)};ee.prototype.write=function(e){let t,n,r;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),r=parseInt(n,10),e.put(r,10);let o=this.data.length-t;o>0&&(n=this.data.substr(t),r=parseInt(n,10),e.put(r,o*3+1))};$n.exports=ee});var Kn=f((to,jn)=>{"use strict";var Hi=F(),ct=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function te(i){this.mode=Hi.ALPHANUMERIC,this.data=i}te.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};te.prototype.getLength=function(){return this.data.length};te.prototype.getBitsLength=function(){return te.getBitsLength(this.data.length)};te.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let n=ct.indexOf(this.data[t])*45;n+=ct.indexOf(this.data[t+1]),e.put(n,11)}this.data.length%2&&e.put(ct.indexOf(this.data[t]),6)};jn.exports=te});var Yn=f((no,Jn)=>{"use strict";var zi=F();function ne(i){this.mode=zi.BYTE,typeof i=="string"?this.data=new TextEncoder().encode(i):this.data=new Uint8Array(i)}ne.getBitsLength=function(e){return e*8};ne.prototype.getLength=function(){return this.data.length};ne.prototype.getBitsLength=function(){return ne.getBitsLength(this.data.length)};ne.prototype.write=function(i){for(let e=0,t=this.data.length;e<t;e++)i.put(this.data[e],8)};Jn.exports=ne});var Wn=f((io,Gn)=>{"use strict";var Di=F(),Ui=D();function ie(i){this.mode=Di.KANJI,this.data=i}ie.getBitsLength=function(e){return e*13};ie.prototype.getLength=function(){return this.data.length};ie.prototype.getBitsLength=function(){return ie.getBitsLength(this.data.length)};ie.prototype.write=function(i){let e;for(e=0;e<this.data.length;e++){let t=Ui.toSJIS(this.data[e]);if(t>=33088&&t<=40956)t-=33088;else if(t>=57408&&t<=60351)t-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);t=(t>>>8&255)*192+(t&255),i.put(t,13)}};Gn.exports=ie});var Zn=f((ro,dt)=>{"use strict";var fe={single_source_shortest_paths:function(i,e,t){var n={},r={};r[e]=0;var o=fe.PriorityQueue.make();o.push(e,0);for(var s,a,l,d,u,y,C,R,k;!o.empty();){s=o.pop(),a=s.value,d=s.cost,u=i[a]||{};for(l in u)u.hasOwnProperty(l)&&(y=u[l],C=d+y,R=r[l],k=typeof r[l]>"u",(k||R>C)&&(r[l]=C,o.push(l,C),n[l]=a))}if(typeof t<"u"&&typeof r[t]>"u"){var q=["Could not find a path from ",e," to ",t,"."].join("");throw new Error(q)}return n},extract_shortest_path_from_predecessor_list:function(i,e){for(var t=[],n=e,r;n;)t.push(n),r=i[n],n=i[n];return t.reverse(),t},find_path:function(i,e,t){var n=fe.single_source_shortest_paths(i,e,t);return fe.extract_shortest_path_from_predecessor_list(n,t)},PriorityQueue:{make:function(i){var e=fe.PriorityQueue,t={},n;i=i||{};for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t.queue=[],t.sorter=i.sorter||e.default_sorter,t},default_sorter:function(i,e){return i.cost-e.cost},push:function(i,e){var t={value:i,cost:e};this.queue.push(t),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};typeof dt<"u"&&(dt.exports=fe)});var si=f(re=>{"use strict";var p=F(),ti=Qn(),ni=Kn(),ii=Yn(),ri=Wn(),me=ot(),Ve=D(),Fi=Zn();function Xn(i){return unescape(encodeURIComponent(i)).length}function we(i,e,t){let n=[],r;for(;(r=i.exec(t))!==null;)n.push({data:r[0],index:r.index,mode:e,length:r[0].length});return n}function oi(i){let e=we(me.NUMERIC,p.NUMERIC,i),t=we(me.ALPHANUMERIC,p.ALPHANUMERIC,i),n,r;return Ve.isKanjiModeEnabled()?(n=we(me.BYTE,p.BYTE,i),r=we(me.KANJI,p.KANJI,i)):(n=we(me.BYTE_KANJI,p.BYTE,i),r=[]),e.concat(t,n,r).sort(function(s,a){return s.index-a.index}).map(function(s){return{data:s.data,mode:s.mode,length:s.length}})}function ut(i,e){switch(e){case p.NUMERIC:return ti.getBitsLength(i);case p.ALPHANUMERIC:return ni.getBitsLength(i);case p.KANJI:return ri.getBitsLength(i);case p.BYTE:return ii.getBitsLength(i)}}function Oi(i){return i.reduce(function(e,t){let n=e.length-1>=0?e[e.length-1]:null;return n&&n.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)},[])}function $i(i){let e=[];for(let t=0;t<i.length;t++){let n=i[t];switch(n.mode){case p.NUMERIC:e.push([n,{data:n.data,mode:p.ALPHANUMERIC,length:n.length},{data:n.data,mode:p.BYTE,length:n.length}]);break;case p.ALPHANUMERIC:e.push([n,{data:n.data,mode:p.BYTE,length:n.length}]);break;case p.KANJI:e.push([n,{data:n.data,mode:p.BYTE,length:Xn(n.data)}]);break;case p.BYTE:e.push([{data:n.data,mode:p.BYTE,length:Xn(n.data)}])}}return e}function Qi(i,e){let t={},n={start:{}},r=["start"];for(let o=0;o<i.length;o++){let s=i[o],a=[];for(let l=0;l<s.length;l++){let d=s[l],u=""+o+l;a.push(u),t[u]={node:d,lastCount:0},n[u]={};for(let y=0;y<r.length;y++){let C=r[y];t[C]&&t[C].node.mode===d.mode?(n[C][u]=ut(t[C].lastCount+d.length,d.mode)-ut(t[C].lastCount,d.mode),t[C].lastCount+=d.length):(t[C]&&(t[C].lastCount=d.length),n[C][u]=ut(d.length,d.mode)+4+p.getCharCountIndicator(d.mode,e))}}r=a}for(let o=0;o<r.length;o++)n[r[o]].end=0;return{map:n,table:t}}function ei(i,e){let t,n=p.getBestModeForData(i);if(t=p.from(e,n),t!==p.BYTE&&t.bit<n.bit)throw new Error('"'+i+'" cannot be encoded with mode '+p.toString(t)+`.
 Suggested mode is: `+p.toString(n));switch(t===p.KANJI&&!Ve.isKanjiModeEnabled()&&(t=p.BYTE),t){case p.NUMERIC:return new ti(i);case p.ALPHANUMERIC:return new ni(i);case p.KANJI:return new ri(i);case p.BYTE:return new ii(i)}}re.fromArray=function(e){return e.reduce(function(t,n){return typeof n=="string"?t.push(ei(n,null)):n.data&&t.push(ei(n.data,n.mode)),t},[])};re.fromString=function(e,t){let n=oi(e,Ve.isKanjiModeEnabled()),r=$i(n),o=Qi(r,t),s=Fi.find_path(o.map,"start","end"),a=[];for(let l=1;l<s.length-1;l++)a.push(o.table[s[l]].node);return re.fromArray(Oi(a))};re.rawSplit=function(e){return re.fromArray(oi(e,Ve.isKanjiModeEnabled()))}});var li=f(ai=>{"use strict";var Ne=D(),ht=xe(),ji=Sn(),Ki=En(),Ji=bn(),Yi=xn(),ft=An(),mt=tt(),Gi=Bn(),Pe=zn(),Wi=On(),Zi=F(),gt=si();function Xi(i,e){let t=i.size,n=Yi.getPositions(e);for(let r=0;r<n.length;r++){let o=n[r][0],s=n[r][1];for(let a=-1;a<=7;a++)if(!(o+a<=-1||t<=o+a))for(let l=-1;l<=7;l++)s+l<=-1||t<=s+l||(a>=0&&a<=6&&(l===0||l===6)||l>=0&&l<=6&&(a===0||a===6)||a>=2&&a<=4&&l>=2&&l<=4?i.set(o+a,s+l,!0,!0):i.set(o+a,s+l,!1,!0))}}function er(i){let e=i.size;for(let t=8;t<e-8;t++){let n=t%2===0;i.set(t,6,n,!0),i.set(6,t,n,!0)}}function tr(i,e){let t=Ji.getPositions(e);for(let n=0;n<t.length;n++){let r=t[n][0],o=t[n][1];for(let s=-2;s<=2;s++)for(let a=-2;a<=2;a++)s===-2||s===2||a===-2||a===2||s===0&&a===0?i.set(r+s,o+a,!0,!0):i.set(r+s,o+a,!1,!0)}}function nr(i,e){let t=i.size,n=Pe.getEncodedBits(e),r,o,s;for(let a=0;a<18;a++)r=Math.floor(a/3),o=a%3+t-8-3,s=(n>>a&1)===1,i.set(r,o,s,!0),i.set(o,r,s,!0)}function pt(i,e,t){let n=i.size,r=Wi.getEncodedBits(e,t),o,s;for(o=0;o<15;o++)s=(r>>o&1)===1,o<6?i.set(o,8,s,!0):o<8?i.set(o+1,8,s,!0):i.set(n-15+o,8,s,!0),o<8?i.set(8,n-o-1,s,!0):o<9?i.set(8,15-o-1+1,s,!0):i.set(8,15-o-1,s,!0);i.set(n-8,8,1,!0)}function ir(i,e){let t=i.size,n=-1,r=t-1,o=7,s=0;for(let a=t-1;a>0;a-=2)for(a===6&&a--;;){for(let l=0;l<2;l++)if(!i.isReserved(r,a-l)){let d=!1;s<e.length&&(d=(e[s]>>>o&1)===1),i.set(r,a-l,d),o--,o===-1&&(s++,o=7)}if(r+=n,r<0||t<=r){r-=n,n=-n;break}}}function rr(i,e,t){let n=new ji;t.forEach(function(l){n.put(l.mode.bit,4),n.put(l.getLength(),Zi.getCharCountIndicator(l.mode,i)),l.write(n)});let r=Ne.getSymbolTotalCodewords(i),o=mt.getTotalCodewordsCount(i,e),s=(r-o)*8;for(n.getLengthInBits()+4<=s&&n.put(0,4);n.getLengthInBits()%8!==0;)n.putBit(0);let a=(s-n.getLengthInBits())/8;for(let l=0;l<a;l++)n.put(l%2?17:236,8);return or(n,i,e)}function or(i,e,t){let n=Ne.getSymbolTotalCodewords(e),r=mt.getTotalCodewordsCount(e,t),o=n-r,s=mt.getBlocksCount(e,t),a=n%s,l=s-a,d=Math.floor(n/s),u=Math.floor(o/s),y=u+1,C=d-u,R=new Gi(C),k=0,q=new Array(s),bt=new Array(s),qe=0,Ci=new Uint8Array(i.buffer);for(let G=0;G<s;G++){let ze=G<l?u:y;q[G]=Ci.slice(k,k+ze),bt[G]=R.encode(q[G]),k+=ze,qe=Math.max(qe,ze)}let He=new Uint8Array(n),_t=0,L,B;for(L=0;L<qe;L++)for(B=0;B<s;B++)L<q[B].length&&(He[_t++]=q[B][L]);for(L=0;L<C;L++)for(B=0;B<s;B++)He[_t++]=bt[B][L];return He}function sr(i,e,t,n){let r;if(Array.isArray(i))r=gt.fromArray(i);else if(typeof i=="string"){let d=e;if(!d){let u=gt.rawSplit(i);d=Pe.getBestVersionForData(u,t)}r=gt.fromString(i,d||40)}else throw new Error("Invalid data");let o=Pe.getBestVersionForData(r,t);if(!o)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=o;else if(e<o)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+o+`.
`);let s=rr(e,t,r),a=Ne.getSymbolSize(e),l=new Ki(a);return Xi(l,e),er(l),tr(l,e),pt(l,t,0),e>=7&&nr(l,e),ir(l,s),isNaN(n)&&(n=ft.getBestMask(l,pt.bind(null,l,t))),ft.applyMask(n,l),pt(l,t,n),{modules:l,version:e,errorCorrectionLevel:t,maskPattern:n,segments:r}}ai.create=function(e,t){if(typeof e>"u"||e==="")throw new Error("No input text");let n=ht.M,r,o;return typeof t<"u"&&(n=ht.from(t.errorCorrectionLevel,ht.M),r=Pe.from(t.version),o=ft.from(t.maskPattern),t.toSJISFunc&&Ne.setToSJISFunction(t.toSJISFunc)),sr(e,r,n,o)}});var wt=f(Y=>{"use strict";function ci(i){if(typeof i=="number"&&(i=i.toString()),typeof i!="string")throw new Error("Color should be defined as hex string");let e=i.slice().replace("#","").split("");if(e.length<3||e.length===5||e.length>8)throw new Error("Invalid hex color: "+i);(e.length===3||e.length===4)&&(e=Array.prototype.concat.apply([],e.map(function(n){return[n,n]}))),e.length===6&&e.push("F","F");let t=parseInt(e.join(""),16);return{r:t>>24&255,g:t>>16&255,b:t>>8&255,a:t&255,hex:"#"+e.slice(0,6).join("")}}Y.getOptions=function(e){e||(e={}),e.color||(e.color={});let t=typeof e.margin>"u"||e.margin===null||e.margin<0?4:e.margin,n=e.width&&e.width>=21?e.width:void 0,r=e.scale||4;return{width:n,scale:n?4:r,margin:t,color:{dark:ci(e.color.dark||"#000000ff"),light:ci(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}};Y.getScale=function(e,t){return t.width&&t.width>=e+t.margin*2?t.width/(e+t.margin*2):t.scale};Y.getImageWidth=function(e,t){let n=Y.getScale(e,t);return Math.floor((e+t.margin*2)*n)};Y.qrToImageData=function(e,t,n){let r=t.modules.size,o=t.modules.data,s=Y.getScale(r,n),a=Math.floor((r+n.margin*2)*s),l=n.margin*s,d=[n.color.light,n.color.dark];for(let u=0;u<a;u++)for(let y=0;y<a;y++){let C=(u*a+y)*4,R=n.color.light;if(u>=l&&y>=l&&u<a-l&&y<a-l){let k=Math.floor((u-l)/s),q=Math.floor((y-l)/s);R=d[o[k*r+q]?1:0]}e[C++]=R.r,e[C++]=R.g,e[C++]=R.b,e[C]=R.a}}});var di=f(ke=>{"use strict";var Ct=wt();function ar(i,e,t){i.clearRect(0,0,e.width,e.height),e.style||(e.style={}),e.height=t,e.width=t,e.style.height=t+"px",e.style.width=t+"px"}function lr(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}ke.render=function(e,t,n){let r=n,o=t;typeof r>"u"&&(!t||!t.getContext)&&(r=t,t=void 0),t||(o=lr()),r=Ct.getOptions(r);let s=Ct.getImageWidth(e.modules.size,r),a=o.getContext("2d"),l=a.createImageData(s,s);return Ct.qrToImageData(l.data,e,r),ar(a,o,s),a.putImageData(l,0,0),o};ke.renderToDataURL=function(e,t,n){let r=n;typeof r>"u"&&(!t||!t.getContext)&&(r=t,t=void 0),r||(r={});let o=ke.render(e,t,r),s=r.type||"image/png",a=r.rendererOpts||{};return o.toDataURL(s,a.quality)}});var gi=f(hi=>{"use strict";var cr=wt();function ui(i,e){let t=i.a/255,n=e+'="'+i.hex+'"';return t<1?n+" "+e+'-opacity="'+t.toFixed(2).slice(1)+'"':n}function vt(i,e,t){let n=i+e;return typeof t<"u"&&(n+=" "+t),n}function dr(i,e,t){let n="",r=0,o=!1,s=0;for(let a=0;a<i.length;a++){let l=Math.floor(a%e),d=Math.floor(a/e);!l&&!o&&(o=!0),i[a]?(s++,a>0&&l>0&&i[a-1]||(n+=o?vt("M",l+t,.5+d+t):vt("m",r,0),r=0,o=!1),l+1<e&&i[a+1]||(n+=vt("h",s),s=0)):r++}return n}hi.render=function(e,t,n){let r=cr.getOptions(t),o=e.modules.size,s=e.modules.data,a=o+r.margin*2,l=r.color.light.a?"<path "+ui(r.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",d="<path "+ui(r.color.dark,"stroke")+' d="'+dr(s,o,r.margin)+'"/>',u='viewBox="0 0 '+a+" "+a+'"',C='<svg xmlns="http://www.w3.org/2000/svg" '+(r.width?'width="'+r.width+'" height="'+r.width+'" ':"")+u+' shape-rendering="crispEdges">'+l+d+`</svg>
`;return typeof n=="function"&&n(null,C),C}});var fi=f(Ce=>{"use strict";var ur=wn(),St=li(),pi=di(),hr=gi();function yt(i,e,t,n,r){let o=[].slice.call(arguments,1),s=o.length,a=typeof o[s-1]=="function";if(!a&&!ur())throw new Error("Callback required as last argument");if(a){if(s<2)throw new Error("Too few arguments provided");s===2?(r=t,t=e,e=n=void 0):s===3&&(e.getContext&&typeof r>"u"?(r=n,n=void 0):(r=n,n=t,t=e,e=void 0))}else{if(s<1)throw new Error("Too few arguments provided");return s===1?(t=e,e=n=void 0):s===2&&!e.getContext&&(n=t,t=e,e=void 0),new Promise(function(l,d){try{let u=St.create(t,n);l(i(u,e,n))}catch(u){d(u)}})}try{let l=St.create(t,n);r(null,i(l,e,n))}catch(l){r(l)}}Ce.create=St.create;Ce.toCanvas=yt.bind(null,pi.render);Ce.toDataURL=yt.bind(null,pi.renderToDataURL);Ce.toString=yt.bind(null,function(i,e,t){return hr.render(i,t)})});var oe=Tt(fi(),1);var pr=["qrcElement"],mi=(()=>{class i{constructor(t,n){this.renderer=t,this.sanitizer=n,this.allowEmptyString=!1,this.colorDark="#000000ff",this.colorLight="#ffffffff",this.cssClass="qrcode",this.elementType="canvas",this.errorCorrectionLevel="M",this.margin=4,this.qrdata="",this.scale=4,this.width=10,this.qrCodeURL=new Bt,this.context=null}ngOnChanges(){return se(this,null,function*(){yield this.createQRCode()})}isValidQrCodeText(t){return this.allowEmptyString===!1?!(typeof t>"u"||t===""||t==="null"||t===null):!(typeof t>"u")}toDataURL(t){return new Promise((n,r)=>{(0,oe.toDataURL)(this.qrdata,t,(o,s)=>{o?r(o):n(s)})})}toCanvas(t,n){return new Promise((r,o)=>{(0,oe.toCanvas)(t,this.qrdata,n,s=>{s?o(s):r("success")})})}toSVG(t){return new Promise((n,r)=>{(0,oe.toString)(this.qrdata,t,(o,s)=>{o?r(o):n(s)})})}renderElement(t){for(let n of this.qrcElement.nativeElement.childNodes)this.renderer.removeChild(this.qrcElement.nativeElement,n);this.renderer.appendChild(this.qrcElement.nativeElement,t)}createQRCode(){return se(this,null,function*(){this.version&&this.version>40?(console.warn("[angularx-qrcode] max value for `version` is 40"),this.version=40):this.version&&this.version<1?(console.warn("[angularx-qrcode]`min value for `version` is 1"),this.version=1):this.version!==void 0&&isNaN(this.version)&&(console.warn("[angularx-qrcode] version should be a number, defaulting to auto."),this.version=void 0);try{if(!this.isValidQrCodeText(this.qrdata))throw new Error("[angularx-qrcode] Field `qrdata` is empty, set 'allowEmptyString=\"true\"' to overwrite this behaviour.");this.isValidQrCodeText(this.qrdata)&&this.qrdata===""&&(this.qrdata=" ");let t={color:{dark:this.colorDark,light:this.colorLight},errorCorrectionLevel:this.errorCorrectionLevel,margin:this.margin,scale:this.scale,version:this.version,width:this.width},n=this.imageSrc,r=this.imageHeight||40,o=this.imageWidth||40;switch(this.elementType){case"canvas":{let s=this.renderer.createElement("canvas");this.context=s.getContext("2d"),this.toCanvas(s,t).then(()=>{if(this.ariaLabel&&this.renderer.setAttribute(s,"aria-label",`${this.ariaLabel}`),this.title&&this.renderer.setAttribute(s,"title",`${this.title}`),n&&this.context){this.centerImage=new Image(o,r),n!==this.centerImage.src&&(this.centerImage.crossOrigin="anonymous",this.centerImage.src=n),r!==this.centerImage.height&&(this.centerImage.height=r),o!==this.centerImage.width&&(this.centerImage.width=o);let a=this.centerImage;a&&(a.onload=()=>{this.context?.drawImage(a,s.width/2-o/2,s.height/2-r/2,o,r)})}this.renderElement(s),this.emitQRCodeURL(s)}).catch(a=>{console.error("[angularx-qrcode] canvas error:",a)});break}case"svg":{let s=this.renderer.createElement("div");this.toSVG(t).then(a=>{this.renderer.setProperty(s,"innerHTML",a);let l=s.firstChild;this.renderer.setAttribute(l,"height",`${this.width}`),this.renderer.setAttribute(l,"width",`${this.width}`),this.renderElement(l),this.emitQRCodeURL(l)}).catch(a=>{console.error("[angularx-qrcode] svg error:",a)});break}case"url":case"img":default:{let s=this.renderer.createElement("img");this.toDataURL(t).then(a=>{this.alt&&s.setAttribute("alt",this.alt),this.ariaLabel&&s.setAttribute("aria-label",this.ariaLabel),s.setAttribute("src",a),this.title&&s.setAttribute("title",this.title),this.renderElement(s),this.emitQRCodeURL(s)}).catch(a=>{console.error("[angularx-qrcode] img/url error:",a)})}}}catch(t){console.error("[angularx-qrcode] Error generating QR Code:",t.message)}})}convertBase64ImageUrlToBlob(t){let n=t.split(";base64,"),r=n[0].split(":")[1],o=atob(n[1]),s=new Uint8Array(o.length);for(let a=0;a<o.length;++a)s[a]=o.charCodeAt(a);return new Blob([s],{type:r})}emitQRCodeURL(t){let n=t.constructor.name;if(n===SVGSVGElement.name){let l=t.outerHTML,d=new Blob([l],{type:"image/svg+xml"}),u=URL.createObjectURL(d),y=this.sanitizer.bypassSecurityTrustUrl(u);this.qrCodeURL.emit(y);return}let r="";n===HTMLCanvasElement.name&&(r=t.toDataURL("image/png")),n===HTMLImageElement.name&&(r=t.src);let o=this.convertBase64ImageUrlToBlob(r),s=URL.createObjectURL(o),a=this.sanitizer.bypassSecurityTrustUrl(s);this.qrCodeURL.emit(a)}static{this.\u0275fac=function(n){return new(n||i)(je(Vt),je(Yt))}}static{this.\u0275cmp=ye({type:i,selectors:[["qrcode"]],viewQuery:function(n,r){if(n&1&&qt(pr,7),n&2){let o;Ht(o=zt())&&(r.qrcElement=o.first)}},inputs:{allowEmptyString:"allowEmptyString",colorDark:"colorDark",colorLight:"colorLight",cssClass:"cssClass",elementType:"elementType",errorCorrectionLevel:"errorCorrectionLevel",imageSrc:"imageSrc",imageHeight:"imageHeight",imageWidth:"imageWidth",margin:"margin",qrdata:"qrdata",scale:"scale",version:"version",width:"width",alt:"alt",ariaLabel:"ariaLabel",title:"title"},outputs:{qrCodeURL:"qrCodeURL"},standalone:!0,features:[Rt,_e],decls:2,vars:2,consts:[["qrcElement",""]],template:function(n,r){n&1&&v(0,"div",null,0),n&2&&be(r.cssClass)},encapsulation:2,changeDetection:0})}}return i})();var I=Tt(vi());var fr=["baseElement"],mr=["waves"],wr=["video"],Cr=["idleVideo"],vr=["container"],Sr=(i,e)=>e.id,yr=i=>({"-start-10 opacity-100":i}),wi=(i,e,t)=>({"bg-red-600":i,"bg-green-700":e,"bg-orange-500":t}),Er=i=>({hidden:i}),br=(i,e)=>({"mdi-chevron-down":i,"mdi-chevron-up":e});function _r(i,e){if(i&1&&(h(0,"span",8),E(1),g()),i&2){let t=b();c(),z(t.recognizedText())}}function Tr(i,e){if(i&1&&v(0,"app-spinner-loader",11),i&2){let t=b();m("color",t.appColors.PRIMARY)("borderWidth",2)("width",20)}}function xr(i,e){if(i&1&&(v(0,"img",21),E(1)),i&2){let t=b();m("src",t.store.isStreamStarted()?"assets/icons/stop.png":"assets/icons/start.png",H),c(),P(" ",t.store.isStreamStarted()?t.lang.locals.stop:t.lang.locals.start," ")}}function Ar(i,e){if(i&1&&(v(0,"app-spinner-loader",11),h(1,"span"),E(2),g()),i&2){let t=b();m("color",t.appColors.PRIMARY)("borderWidth",2)("width",20),c(2),z(t.lang.locals.loading)}}function Ir(i,e){if(i&1&&(v(0,"img",21),h(1,"span"),E(2),g()),i&2){let t=b();m("src","assets/icons/speak.png",H),c(2),z(t.lang.locals.click_to_speak)}}function Rr(i,e){if(i&1&&(v(0,"img",21),h(1,"span"),E(2),g()),i&2){let t=b();m("src","assets/icons/speak.png",H),c(2),z(t.lang.locals.listening_ongoing)}}function Mr(i,e){if(i&1&&(v(0,"div",40),Ze(1,"sanitizer"),h(2,"span"),E(3),g()),i&2){let t=b();m("innerHTML",Ot(1,2,t.svgIcons.SEND,"html"),Qe),c(3),z(t.lang.locals.click_to_send)}}function Lr(i,e){if(i&1){let t=de();h(0,"div",43),x("animating",function(r){_(t);let o=b(2);return T(o.animationStatus.set(r))}),g()}if(i&2){let t=b().$implicit;m("text",t.content)}}function Br(i,e){if(i&1&&v(0,"div",42),i&2){let t=b().$implicit;m("innerHtml",t.content,Qe)}}function Vr(i,e){if(i&1&&(h(0,"div",48)(1,"div",49)(2,"small",50),E(3),v(4,"i",51),g()(),h(5,"a",52),E(6),g()()),i&2){let t=e.$implicit,n=e.$index;c(3),P(" doc ",n+1," "),c(3),z(t.filepath)}}function Pr(i,e){if(i&1){let t=de();h(0,"div")(1,"div",44),x("click",function(){_(t);let r=Ye(6);return T(r.hidden=!r.hidden)}),v(2,"i",45),h(3,"span",46),E(4,"References"),g()(),h(5,"div",47,5),Ke(7,Vr,7,2,"div",48,kt),g()()}if(i&2){let t=Ye(6),n=b().$implicit;c(2),m("ngClass",Ut(1,br,t.hidden,!t.hidden)),c(5),Je(n.context.citations)}}function Nr(i,e){if(i&1&&(h(0,"div"),Z(1,Lr,1,1,"div",41)(2,Br,1,1,"div",42)(3,Pr,9,4,"div"),g()),i&2){let t=e.$implicit;Nt("message ",t.role,""),c(),M(t.role==="assistant"?1:2),c(2),M(t.context&&t.context.citations.length?3:-1)}}function kr(i,e){if(i&1){let t=de();h(0,"div",53),x("click",function(){_(t);let r=b();return T(r.qrCodeOpened=!1)}),h(1,"div",54),x("click",function(r){return _(t),T(r.stopPropagation())}),v(2,"qrcode",55),h(3,"span",56),E(4),g(),h(5,"button",57),x("click",function(){_(t);let r=b();return T(r.qrCodeOpened=!1)}),le(),h(6,"svg",58),v(7,"path",15),g()()()()}if(i&2){let t=b();c(2),m("qrdata",t.getQRData()),c(2),P("streamId: ",t.store.streamId(),"")}}var Et=class i extends sn(class{}){baseElement=W.required("baseElement");waves=W.required("waves");video=W.required("video");idleVideo=W("idleVideo");chatContainer=W.required("container");avatarService=V(ln);lang=V(Wt);store=V(Xt);chatService=V(on);chatHistoryService=V(un);speechService=V(dn);injector=V(Lt);router=V(Gt);svgIcons=en;appColors=gn;start$=new Ue(1);stop$=new Ue(1);recognizedText=ce("");recognizingText=ce("");recognized$=new De;accept$=new De;recognizingStatus=ce(!1);botNames$=this.chatHistoryService.getAllBotNames().pipe(Q(e=>this.chatService.botNameCtrl.patchValue(e.at(0))));animationStatus=ce(!1);qrCodeOpened=!1;init$=this.start$.asObservable().pipe(Q(()=>this.store.updateStreamStatus("InProgress"))).pipe(ae(this.destroy$)).pipe($e(()=>this.avatarService.startStream("life-size").pipe(At(e=>{throw this.store.updateStreamStatus("Stopped"),e})).pipe(Te()))).pipe($(e=>{let{data:{webrtcData:{offer:t,iceServers:n}}}=e;return this.pc=new RTCPeerConnection({iceServers:n,iceTransportPolicy:"relay"}),this.pc.addEventListener("icecandidate",r=>{r.candidate&&this.avatarService.sendCandidate(r.candidate).subscribe()}),this.pc.addEventListener("icegatheringstatechange",r=>{r.target.iceGatheringState=="complete"&&this.video().nativeElement.paused&&(this.video().nativeElement.play().then(),this.store.updateStreamStatus("Started"))}),this.pc.addEventListener("track",r=>{this.video().nativeElement.srcObject=r.streams[0]}),this.pc.addEventListener("connectionstatechange",r=>{let o=r.target.connectionState;o==="connected"&&this.store.updateStreamStatus("Started"),o==="disconnected"&&this.store.updateStreamStatus("Stopped")}),ve(this.pc.setRemoteDescription(new RTCSessionDescription(t))).pipe($(()=>ve(this.pc.createAnswer()))).pipe($(r=>ve(this.pc.setLocalDescription(r)).pipe(Se(()=>r)))).pipe($(r=>this.avatarService.sendAnswer(r)))})).pipe(Se(()=>""));onlineStatus=$t(()=>{switch(this.lang.localChange(),this.store.streamingStatus()){case"Started":return this.lang.locals.connected;case"InProgress":return this.lang.locals.connecting;case"Disconnecting":return this.lang.locals.disconnecting;default:return this.lang.locals.not_connected}});ngOnInit(){return se(this,null,function*(){this.store.updateStreamStatus("Stopped"),xt(this.destroy$).pipe(Q(()=>this.store.updateStreamStatus("Stopped"))).pipe($(()=>this.avatarService.closeStream().pipe(Te()))).subscribe(()=>{console.log("COMPONENT DESTROYED")}),this.stop$.pipe(Fe(()=>this.store.hasStream())).pipe(Q(()=>this.store.updateStreamStatus("Disconnecting"))).pipe(ae(this.destroy$)).pipe($(()=>this.avatarService.closeStream().pipe(Te()))).subscribe(()=>{this.store.updateStreamStatus("Stopped"),console.log("MANUAL CLOSE"),this.store.updateStreamStatus("Stopped")}),this.start$.next(),this.listenToAccept(),this.listenToBotNameChange(),this.prepareRecorder()})}ngAfterViewInit(){this.playIdle()}toggleStream(){this.store.isStreamLoading()||(this.store.isStreamStopped()?this.start$.next():this.stop$.next())}interruptAvatar(){this.avatarService.interruptAvatar().pipe(Oe(1)).subscribe()}clearChat(){this.chatService.messages.set([])}startRecording(){this.store.recordingInProgress(),this.recognizer.startContinuousRecognitionAsync(()=>{this.recognizer.internalData.privConnectionPromise.__zone_symbol__state===!0&&this.store.recordingStarted(),this.recognizingStatus.set(!0)})}stopRecording(){this.recognizer.stopContinuousRecognitionAsync(()=>{this.store.recordingStopped()})}toggleRecording(){this.store.isRecordingLoading()||(this.store.isRecordingStarted()?this.acceptText():this.startRecording())}acceptText(){this.accept$.next()}rejectText(){this.recognizingText.set(""),this.recognizedText.set(""),this.recognizingStatus.set(!1),this.stopRecording()}goToEndOfChat(){setTimeout(()=>{let e=this.chatContainer().nativeElement.querySelectorAll(".user");e[e.length-1].scrollIntoView({behavior:"smooth"})},100)}prepareRecorder(){this.waveSurfer=new pn({waveColor:"white",progressColor:"white",container:this.waves().nativeElement,height:"auto"}),this.recorder=this.waveSurfer.registerPlugin(fn.create({scrollingWaveform:!1})),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(n=>this.recorder.renderMicStream(n));let e=I.AudioConfig.fromDefaultMicrophoneInput(),t=I.AutoDetectSourceLanguageConfig.fromLanguages(["ar-QA","en-US"]);this.recognizer=I.SpeechRecognizer.FromConfig(I.SpeechConfig.fromAuthorizationToken(this.store.speechToken.token(),this.store.speechToken.region()),t,e),this.recognizer.recognizing=(n,r)=>{r.result.reason===I.ResultReason.RecognizingSpeech&&(this.recognizingText.set(this.recognizedText()+" "+r.result.text),this.recognizingStatus.set(!0))},this.recognizer.recognized=(n,r)=>{r.result.reason===I.ResultReason.RecognizedSpeech&&this.store.isRecordingStarted()&&(this.recognizedText.update(o=>o+" "+r.result.text),this.recognized$.next(),this.recognizingStatus.set(!1))},this.recognizer.canceled=()=>{this.store.recordingInProgress(),this.speechService.generateSpeechToken().pipe(Oe(1)).subscribe(()=>{this.prepareRecorder(),this.startRecording()})}}listenToAccept(){this.accept$.pipe(Se(()=>this.recognizedText())).pipe(Fe(e=>!!e)).pipe(ae(this.destroy$)).pipe(Q(()=>{this.recognizedText.set(""),this.recognizingText.set(""),this.recognizingStatus.set(!1),this.stopRecording()})).pipe(Q(()=>this.goToEndOfChat())).pipe($e(e=>this.chatService.sendMessage(e,this.chatService.botNameCtrl.value))).pipe(It(200)).subscribe(()=>{let e=this.chatContainer().nativeElement.querySelectorAll(".assistant"),t=Qt(()=>{this.animationStatus()||(e[e.length-1].scrollIntoView({behavior:"smooth"}),t.destroy())},{injector:this.injector})})}listenToBotNameChange(){this.chatService.onBotNameChange().pipe(ae(this.destroy$)).subscribe()}toggleFullScreen(){document.fullscreenElement?document.exitFullscreen().then():this.baseElement().nativeElement.requestFullscreen().then()}isFullScreen(){return!!document.fullscreenElement}getQRData(){return`${this.getOrigin()}/control?streamId=${this.store.streamId()}`}getOrigin(){let e=location.href.lastIndexOf(this.router.url);return location.href.slice(0,e)}playIdle(){this.idleVideo()&&this.idleVideo()?.nativeElement&&(this.idleVideo().nativeElement.src=this.store.idleAvatarUrl(),this.idleVideo().nativeElement.muted=!0,this.idleVideo().nativeElement.loop=!0,this.idleVideo().nativeElement.play().then())}static \u0275fac=(()=>{let e;return function(n){return(e||(e=Mt(i)))(n||i)}})();static \u0275cmp=ye({type:i,selectors:[["app-temp-avatar"]],viewQuery:function(t,n){t&1&&(X(n.baseElement,fr,5),X(n.waves,mr,5),X(n.video,wr,5),X(n.idleVideo,Cr,5),X(n.chatContainer,vr,5)),t&2&&Dt(5)},hostVars:2,hostBindings:function(t,n){t&2&&be("block h-full w-full")},standalone:!0,features:[Pt,_e],decls:55,vars:43,consts:[["baseElement",""],["waves",""],["video",""],["idleVideo",""],["container",""],["linkRef",""],[1,"relative","h-full","w-full","flex","items-center","justify-center","bg-secondary-100/80","rounded-xl","shadow"],[1,"flex","flex-col","items-center","h-full","justify-center","absolute"],[1,"absolute","w-[90%]","z-10","bottom-1/2","left-1/2","-translate-x-1/2","bg-black/70","text-white","text-sm","rounded","px-2","py-1"],[1,"absolute","-start-20","top-1/2","-translate-y-1/2","!w-16","flex","flex-col","gap-2"],[1,"!h-16","flex","flex-col","items-center","justify-center","bg-white","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"pointerdown","disabled"],[3,"color","borderWidth","width"],[1,"relative","w-full"],["matTooltipPosition","before","appButton","","shape","pill",1,"!p-1","!absolute","top-1/2","-translate-y-1/2","opacity-0","transition-all","duration-300",3,"click","matTooltip","ngClass"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"w-5","h-5"],["d","M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"],[1,"relative","w-full","!h-16","flex","flex-col","items-center","justify-center","bg-white","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"!h-16","flex","flex-col","items-center","justify-center","bg-white","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"relative","size-6"],["alt","start",1,"w-full","h-full",3,"src"],["alt","start",1,"absolute","top-0","left-0","w-full","h-full","opacity-60",3,"src"],["alt","start",1,"size-6",3,"src"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-8"],["d","M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z"],[1,"!h-16","flex","flex-col","items-center","justify-center","bg-white","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"click"],["d","M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z"],[1,"w-full","absolute","top-2","px-2","flex","justify-between","items-center"],[1,"relative","flex","items-center","gap-2","shadow-2xl","shadow-white","bg-black/20","py-1","px-2","rounded-full"],[1,"text-white","text-sm","font-semibold"],[1,"p-2","rounded-full",3,"ngClass"],[1,"p-2","absolute","end-2","pulse","rounded-full",3,"ngClass"],[1,"w-28","h-6","overflow-hidden","transition-all","rounded-full","border","border-white/30",3,"ngClass"],[1,"w-full","pointer-events-none","h-full","opacity-90"],["autoplay","",1,"h-full",3,"hidden"],[1,"h-full",3,"hidden"],["type","video/webm",3,"src"],[1,"absolute","bottom-0","w-full","max-h-[45%]","overflow-y-auto","no-scrollbar","overflow-x-hidden"],[1,"min-h-0","flex-auto","flex","flex-col","gap-1","w-full","h-full","relative","overflow-hidden","py-1","px-2","[&>.message.user]:justify-start","[&>.message]:text-white"],[3,"class"],[1,"absolute","w-full","h-full","flex","items-center","justify-center","bg-black/80"],[1,"size-6",3,"innerHTML"],["appTextWriterAnimator","",1,"whitespace-pre-wrap","break-words",3,"text"],[1,"whitespace-pre-wrap","break-words",3,"innerHtml"],["appTextWriterAnimator","",1,"whitespace-pre-wrap","break-words",3,"animating","text"],[1,"icon-with-title",3,"click"],[1,"mdi",3,"ngClass"],[1,"title"],["hidden",""],["dir","auto"],[1,"d-inline"],[1,"px-1","text-primary"],[1,"mdi","mdi-link-variant"],[1,"d-inline","citation-link",2,"cursor","pointer"],[1,"absolute","w-full","h-full","flex","items-center","justify-center","bg-black/80",3,"click"],[1,"relative","flex","flex-col","justify-center","items-center","gap-2",3,"click"],[3,"qrdata"],[1,"p-1","text-white"],[1,"w-10","h-10","p-1","text-white","rounded-full","bg-white/30",3,"click"],["fill","currentColor","viewBox","0 0 24 24"]],template:function(t,n){if(t&1){let r=de();h(0,"div",6,0)(2,"div",7),Z(3,_r,2,1,"span",8),h(4,"div",9)(5,"button",10),x("pointerdown",function(){return _(r),T(n.toggleStream())}),Z(6,Tr,1,3,"app-spinner-loader",11)(7,xr,2,2),g(),h(8,"div",12)(9,"button",13),x("click",function(){return _(r),T(n.rejectText())}),le(),h(10,"svg",14),v(11,"path",15),g()(),Ee(),h(12,"button",16),x("click",function(){return _(r),T(n.toggleRecording())}),Z(13,Ar,3,4)(14,Ir,3,2)(15,Rr,3,2)(16,Mr,4,5),g()(),h(17,"button",17),x("click",function(){return _(r),T(n.interruptAvatar())}),h(18,"span",18),v(19,"img",19)(20,"img",20),g(),E(21),g(),h(22,"button",17),x("click",function(){return _(r),T(n.clearChat())}),v(23,"img",21),E(24),g(),h(25,"button",17),x("click",function(){return _(r),T(n.qrCodeOpened=!0)}),le(),h(26,"svg",22),v(27,"path",23),g(),E(28),g(),Ee(),h(29,"button",24),x("click",function(){return _(r),T(n.toggleFullScreen())}),le(),h(30,"svg",22),v(31,"path",25),g(),E(32),g()(),Ee(),h(33,"div",26)(34,"div",27)(35,"span",28),E(36),g(),v(37,"div",29)(38,"div",30),g(),h(39,"div",31),v(40,"div",32,1),g()(),v(42,"video",33,2),h(44,"video",34,3),v(46,"source",35),g(),h(47,"div",36)(48,"div",37,4),Ke(50,Nr,4,5,"div",38,Sr),g()(),Z(52,kr,8,2,"div",39),g(),E(53),Ze(54,"async"),g()}t&2&&(c(3),M(n.recognizedText()?3:-1),c(2),m("disabled",n.store.isStreamLoading()),c(),M(n.store.isStreamLoading()?6:7),c(3),m("matTooltip",n.lang.locals.cancel_recording)("ngClass",Ge(31,yr,n.store.isRecordingStarted())),c(3),m("disabled",n.store.isRecordingLoading()||n.recognizingStatus()),c(),M(n.store.isRecordingLoading()?13:-1),c(),M(n.store.isRecordingStopped()?14:-1),c(),M(n.store.isRecordingStarted()&&n.recognizingStatus()?15:-1),c(),M(n.store.isRecordingStarted()&&!n.recognizingStatus()?16:-1),c(),m("disabled",!n.store.isStreamStarted()),c(2),m("src","assets/icons/speak.png",H),c(),m("src","assets/icons/stop.png",H),c(),P(" ",n.lang.locals.stop_talking," "),c(),m("disabled",!n.chatService.messages().length),c(),m("src","assets/icons/clear-chat.png",H),c(),P(" ",n.lang.locals.clear_chat_history," "),c(),m("disabled",!n.store.isStreamStarted()),c(3),P(" ",n.lang.locals.qr_code," "),c(4),P(" ",n.lang.locals.full_screen," "),c(4),z(n.onlineStatus()),c(),m("ngClass",We(33,wi,n.store.isStreamStopped(),n.store.isStreamStarted(),n.store.isStreamLoading())),c(),m("ngClass",We(37,wi,n.store.isStreamStopped(),n.store.isStreamStarted(),n.store.isStreamLoading())),c(),m("ngClass",Ge(41,Er,!n.store.isRecordingStarted())),c(3),m("hidden",n.store.isStreamStopped()||n.store.isStreamLoading()),c(2),m("hidden",n.store.isStreamStarted()),c(2),m("src",n.store.idleAvatarUrl(),H),c(4),Je(n.chatService.messages()),c(2),M(n.qrCodeOpened&&n.store.isStreamStarted()?52:-1),c(),P(" ",Ft(54,29,n.init$),`
`))},dependencies:[Jt,jt,Kt,tn,hn,rn,nn,Zt,an,cn,mi],styles:['.message[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;font-size:.75rem;line-height:1rem}.message.user[_ngcontent-%COMP%]{align-items:flex-start}.message.user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border-radius:.375rem;border-top-right-radius:0;background-color:#00000080;padding:.125rem}.message.user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:after{content:"";position:absolute;right:-8px;top:0;width:8px;height:8px;clip-path:polygon(0 0,100% 0,0 100%);background-color:inherit}.message.assistant[_ngcontent-%COMP%]{align-items:flex-end}.message.assistant[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border-radius:.375rem;border-top-left-radius:0;background-color:#0003;padding:.125rem}.message.assistant[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:after{content:"";position:absolute;left:-8px;top:0;background-color:inherit;width:8px;height:8px;clip-path:polygon(0 0,100% 0,100% 100%)}']})};export{Et as default};
