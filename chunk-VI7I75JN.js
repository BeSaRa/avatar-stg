import{b as p}from"./chunk-27NONHNX.js";import{b as w}from"./chunk-LQAATZVK.js";import{a as E}from"./chunk-FWDT53KA.js";import{d as U,e as R}from"./chunk-FEAJVVOQ.js";import{a as S,b as M,n as b}from"./chunk-JZHZ6J63.js";import{b as C,f as I}from"./chunk-6RRUKESK.js";import{B as u,P as l,W as d,X as h,a as m,ha as f,ka as v,qa as o,zb as a}from"./chunk-UVO63754.js";var A=class c{http=o(I);urlService=o(S);store=o(w);lang=o(M);messages=a([]);status=a(!1);conversationId=a("");showLegal=a(!1);sendMessage(s,r){let n=`${this.urlService.URLS.CHAT}/${r}`;return this.messages.update(e=>[...e,new p(s,"user")]),this.http.post(n,m(m(m({messages:this.messages()},this.store.streamId()?{stream_id:this.store.streamId()}:null),this.conversationId()?{conversation_id:this.conversationId()}:null),this.getUserId()?{user_id:this.getUserId()}:null)).pipe(l(e=>{throw new p().clone({content:e.message,role:"error"}),new Error(e)})).pipe(u(e=>(e.message.content=U(R(e.message.content,e.message)),e.message=new p().clone(e.message),this.conversationId.set(e.message.conversation_id),this.messages.update(i=>[...i,e.message]),e)))}botNameCtrl=new b("",{nonNullable:!0});onBotNameChange(){return this.botNameCtrl.valueChanges.pipe(d(),f(()=>{this.conversationId.set(""),this.messages.set([])}))}uploadDocument(s,r,n){let e=`${this.urlService.URLS.CHATBOT_UPLOAD_DOCUMENT}`,i=new FormData;Array.from(s).forEach(t=>{i.append("files",t,t.name)});let g=new C().set("bot_name",r);return n&&(g=g.set("conversation_id",n)),this.http.post(e,i,{params:g}).pipe(u(t=>(this.conversationId.set(t.data||""),t.data)),h(()=>this.sendMessage("summarize",r).pipe(l(t=>{throw console.error("Error sending summarize message:",t),t}))),l(t=>{throw console.error("Error uploading document:",t),t}))}getUserId(){let s=localStorage.getItem(E.USER),r="";return s&&(r=JSON.parse(s).user_id),r}static \u0275fac=function(r){return new(r||c)};static \u0275prov=v({token:c,factory:c.\u0275fac,providedIn:"root"})};export{A as a};
