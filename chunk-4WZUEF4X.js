import{v as C}from"./chunk-S4H5QRWI.js";import{a as H}from"./chunk-CG77X37E.js";import{a as q}from"./chunk-CIVIJKHP.js";import{i as $}from"./chunk-3Y4VIYVE.js";import{A as L,B as P,b as Z,e as G,j as B,k as Q,o as W,r as j,u as O}from"./chunk-V32KLUJ4.js";import"./chunk-DCSLL5ZG.js";import{$b as i,Ab as E,B as v,Ea as I,Fa as k,Fc as z,Kb as h,Kc as A,Lc as D,Qb as _,R as b,Vb as M,_b as s,ac as c,da as w,ea as S,ec as U,hc as F,jc as y,nd as R,ob as a,qa as f,ua as V,uc as K,vc as T,xc as l,yc as p,zc as N}from"./chunk-IAZQTHFA.js";var X=["indexedChart"],Y=["keywordsChart"];function ee(d,o){if(d&1){let e=U();s(0,"div",13),c(1,"canvas",14,0),i(),s(3,"button",15),F("click",function(){I(e);let m=y();return k(m.resetIndexedZoom())}),l(4),i()}if(d&2){let e=o,t=y();a(),_("type",e.chart.type)("datasets",e.chart.data.datasets)("labels",e.chart.data.labels)("options",e.chart.options),a(3),N(" ",t.lang.locals.reset_zoom," ")}}function te(d,o){d&1&&c(0,"div",16)(1,"div",17)}function oe(d,o){if(d&1){let e=U();s(0,"div",13),c(1,"canvas",14,1),i(),s(3,"button",15),F("click",function(){I(e);let m=y();return k(m.resetKeywordsZoom())}),l(4),i()}if(d&2){let e=o,t=y();a(),_("type",e.chart.type)("datasets",e.chart.data.datasets)("labels",e.chart.data.labels)("options",e.chart.options),a(3),N(" ",t.lang.locals.reset_zoom," ")}}function ne(d,o){d&1&&c(0,"div",16)(1,"div",17)}var J=class d{lang=f(Z);adminService=f(q);crawlingService=f(H);fb=f(L);reportCount$=this.adminService.getReportsCount();urlCount$=this.adminService.getUrlsCount();mostIndexedChart=E("indexedChart",{read:C});mostUsedKeywordsChart=E("keywordsChart",{read:C});indexedForm=this.fb.group({from_date:[""],to_date:[""]},{validators:$([["from_date","to_date"]],["DateInvalidRangeIndexed"])});keywordsForm=this.fb.group({from_date:[""],to_date:[""]},{validators:$([["from_date","to_date"]],["DateInvalidRangeKeyword"])});mostIndexedUrl$=this.indexedForm.valueChanges.pipe(w(this.indexedForm.value),b(300),S(({from_date:o,to_date:e})=>this.crawlingService.getMostIndexedStatistics(o,e)),v(o=>({title:this.lang.locals.most_indexed_urls,chart:this.getChartConfig(o)})));mostUsedKeywords$=this.keywordsForm.valueChanges.pipe(w(this.keywordsForm.value),b(300),S(({from_date:o,to_date:e})=>this.crawlingService.getMostUsedKeywordStatistics(o,e)),v(o=>({title:this.lang.locals.most_used_keywords,chart:this.getKeywordChartConfig(o)})));getChartConfig(o){let e=new Map;o.forEach(n=>{let r=decodeURIComponent(n.Most_indexed_URL),x=n.IndexDate,u=e.get(r)||{count:0,dates:new Set};u.count+=n.Count,u.dates.add(x),e.set(r,u)});let t=Array.from(e.entries()).sort((n,r)=>n[1].count-r[1].count),m=t.map(([n,r])=>`${n} (${Array.from(r.dates).join(", ")})`),g=t.map(n=>n[1].count);return{type:"bar",data:{labels:m,datasets:[{label:this.lang.locals.links_count,data:g,backgroundColor:"rgba(138, 21, 56, 0.5)",borderColor:"rgba(138, 21, 56)",borderWidth:2}]},options:this.getChartOptions()}}getKeywordChartConfig(o){let e=new Map;o.forEach(n=>{let r=n["Most-used-keywords"].trim(),x=n.IndexDate,u=e.get(r)||{count:0,dates:new Set};u.count+=n.Count,u.dates.add(x),e.set(r,u)});let t=Array.from(e.entries()).sort((n,r)=>n[1].count-r[1].count),m=t.map(([n,r])=>`${n} (${Array.from(r.dates).join(", ")})`),g=t.map(n=>n[1].count);return{type:"bar",data:{labels:m,datasets:[{label:this.lang.locals.keywords_count,data:g,backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235)",borderWidth:2}]},options:this.getChartOptions()}}getChartOptions(){return{responsive:!0,indexAxis:"y",plugins:{legend:{display:!0},zoom:{zoom:{wheel:{enabled:!0},drag:{enabled:!0},pinch:{enabled:!0},mode:"xy"},pan:{enabled:!0,mode:"xy"},limits:{x:{min:0},y:{min:0}}}},scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:12}}}}}}resetIndexedZoom(){this.mostIndexedChart()?.chart?.resetZoom()}resetKeywordsZoom(){this.mostUsedKeywordsChart()?.chart?.resetZoom()}static \u0275fac=function(e){return new(e||d)};static \u0275cmp=V({type:d,selectors:[["app-statistics"]],viewQuery:function(e,t){e&1&&(K(t.mostIndexedChart,X,5,C),K(t.mostUsedKeywordsChart,Y,5,C)),e&2&&T(2)},standalone:!0,features:[z],decls:36,vars:16,consts:[["indexedChart",""],["keywordsChart",""],[1,"w-full","mx-auto","p-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"col-span-1","p-8","bg-white","rounded-2xl","shadow-lg","border","border-gray-200"],[1,"text-2xl","font-semibold","text-gray-700","mb-1"],[1,"text-xs","text-gray-500","mb-3"],[1,"flex","gap-4","mb-4","text-gray-700",3,"formGroup"],[1,"flex","flex-col","flex-auto"],["for","from_date",1,"text-sm","font-medium"],["type","date","formControlName","from_date",1,"rounded-md","p-2","border-2","border-gray-300","outline-none","focus:border-primary"],["for","to_date",1,"text-sm","font-medium"],["type","date","formControlName","to_date",1,"rounded-md","p-2","border-2","border-gray-300","outline-none","focus:border-primary"],[2,"display","block"],["baseChart","",1,"max-h-56",3,"type","datasets","labels","options"],[1,"mt-2","text-sm","text-blue-500","hover:underline",3,"click"],[1,"h-10","bg-gray-300","rounded","animate-pulse","mb-4"],[1,"h-56","bg-gray-300","rounded","animate-pulse"]],template:function(e,t){if(e&1&&(s(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),l(4),i(),s(5,"p",6),l(6),i(),s(7,"form",7)(8,"div",8)(9,"label",9),l(10),i(),c(11,"input",10),i(),s(12,"div",8)(13,"label",11),l(14),i(),c(15,"input",12),i()(),h(16,ee,5,5),A(17,"async"),h(18,te,2,0),i(),s(19,"div",4)(20,"h2",5),l(21),i(),s(22,"p",6),l(23),i(),s(24,"form",7)(25,"div",8)(26,"label",9),l(27),i(),c(28,"input",10),i(),s(29,"div",8)(30,"label",11),l(31),i(),c(32,"input",12),i()(),h(33,oe,5,5),A(34,"async"),h(35,ne,2,0),i()()()),e&2){let m,g;a(4),p(t.lang.locals.most_indexed_urls),a(2),p(t.lang.locals.chart_zoom_tip),a(),_("formGroup",t.indexedForm),a(3),p(t.lang.locals.start_time),a(4),p(t.lang.locals.end_time),a(2),M((m=D(17,12,t.mostIndexedUrl$))?16:18,m),a(5),p(t.lang.locals.most_used_keywords),a(2),p(t.lang.locals.chart_zoom_tip),a(),_("formGroup",t.keywordsForm),a(3),p(t.lang.locals.start_time),a(4),p(t.lang.locals.end_time),a(2),M((g=D(34,14,t.mostUsedKeywords$))?33:35,g)}},dependencies:[R,C,P,W,G,B,Q,j,O],encapsulation:2})};export{J as StatisticsComponent};
