import{a as Ae}from"./chunk-NDL6VD3Y.js";import{a as je}from"./chunk-NWXPPWOY.js";import{a as Ee,b as Me}from"./chunk-L2OPFK6C.js";import{a as F}from"./chunk-2MHWPFOM.js";import{a as j}from"./chunk-VI7I75JN.js";import{a as Le}from"./chunk-FDUHK4JZ.js";import"./chunk-4I6XGE32.js";import"./chunk-27NONHNX.js";import{c as N}from"./chunk-DEUCULCI.js";import{a as Ne}from"./chunk-I6674MYI.js";import{a as ke}from"./chunk-IA6SH5H3.js";import{b as M}from"./chunk-LQAATZVK.js";import{a as ze,b as Ie}from"./chunk-Z3K2Z3BL.js";import{d as he,f as fe}from"./chunk-3B3WBCR2.js";import"./chunk-FWDT53KA.js";import{a as Re}from"./chunk-3HIEYE76.js";import"./chunk-NBFOU5XV.js";import"./chunk-QDK5XKTO.js";import{a as D}from"./chunk-6BC4QFZY.js";import{b as Te}from"./chunk-46G4OXLF.js";import"./chunk-RCUMT5X2.js";import{c as ve,d as Ce,f as L,g as A,i as Se}from"./chunk-OK5S6IU3.js";import"./chunk-FEAJVVOQ.js";import{B as E,b as R,e as _e,g as xe,j as ye,n as we,q as be}from"./chunk-JZHZ6J63.js";import"./chunk-6RRUKESK.js";import{B as J,Dc as T,Ea as q,Fa as H,Fb as I,Fc as C,Ga as oe,Ha as ae,Ia as z,Ic as pe,K,Ka as se,Kb as y,Kc as de,N as X,Ob as a,P as ee,Qa as le,Ra as W,T as B,Tb as g,V as te,X as ie,Y as ne,Yb as o,Zb as s,_b as p,_c as me,cc as G,ea as re,f as Fe,fa as U,fc as h,ha as S,hc as u,i as P,ib as ce,jb as _,jd as ue,ld as k,ob as n,q as $,qa as l,rd as ge,ua as b,uc as Q,vc as d,wc as f,x as O,xc as v,zb as x}from"./chunk-UVO63754.js";var m=Fe(Ne());var $e=i=>({"-start-10 opacity-100":i});function Oe(i,e){if(i&1&&(p(0,"app-spinner-loader",11),o(1,"span"),d(2),s()),i&2){let r=u();a("color",r.appColors.PRIMARY)("borderWidth",2)("width",20),n(2),f(r.lang.locals.loading)}}function Be(i,e){if(i&1&&(p(0,"img",10),o(1,"span"),d(2),s()),i&2){let r=u();a("src","assets/icons/speak.png",_),n(2),f(r.lang.locals.click_to_speak)}}function Ue(i,e){if(i&1&&(p(0,"img",10),o(1,"span"),d(2),s()),i&2){let r=u();a("src","assets/icons/speak.png",_),n(2),f(r.lang.locals.listening_ongoing)}}function qe(i,e){if(i&1&&(p(0,"div",12),pe(1,"sanitizer"),o(2,"span"),d(3),s()),i&2){let r=u();a("innerHTML",de(1,2,r.svgIcons.SEND,"html"),ce),n(3),f(r.lang.locals.click_to_send)}}var V=class i extends D(class{}){overlayChatComponent=W.required();waves=W.required();store=l(M);chatService=l(j);chatHistoryService=l(Re);avatarService=l(N);injector=l(se);recognizedText=x("");recognizingText=x("");speechService=l(ke);recognizing$=le();recognized$=new $;accept$=new $;recognizingStatus=x(!1);botNames$=this.chatHistoryService.getAllBotNames().pipe(S(e=>this.chatService.botNameCtrl.patchValue(e.at(0))));lang=l(R);appColors=Ae;svgIcons=ze;ngOnInit(){return P(this,null,function*(){this.listenToAccept(),this.listenToBotNameChange(),yield this.prepareRecorder()})}listenToBotNameChange(){this.chatService.onBotNameChange().pipe(U(this.destroy$)).subscribe()}prepareRecorder(){return P(this,null,function*(){this.recordingStream=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),this.waveSurfer=new Ee({waveColor:"white",progressColor:"white",container:this.waves(),height:"auto"}),this.recorder=this.waveSurfer.registerPlugin(Me.create({scrollingWaveform:!1})),this.recorder.renderMicStream(this.recordingStream);let e=m.AudioConfig.fromDefaultMicrophoneInput(),r=m.AutoDetectSourceLanguageConfig.fromLanguages(["ar-QA","en-US","zh-CN","wuu-CN"]);this.recognizer=m.SpeechRecognizer.FromConfig(m.SpeechConfig.fromAuthorizationToken(this.store.speechToken.token(),this.store.speechToken.region()),r,e),this.recognizer.recognizing=(t,c)=>{c.result.reason===m.ResultReason.RecognizingSpeech&&(this.recognizingText.set(this.recognizedText()+" "+c.result.text),this.recognizing$.emit(this.recognizingText()),this.recognizingStatus.set(!0))},this.recognizer.recognized=(t,c)=>{c.result.reason===m.ResultReason.RecognizedSpeech&&this.store.isRecordingStarted()&&(this.recognizedText.update(w=>w+" "+c.result.text),this.recognized$.next(),this.recognizingStatus.set(!1))},this.recognizer.canceled=()=>{this.store.recordingInProgress(),this.speechService.generateSpeechToken().pipe(B(1)).subscribe(()=>{this.prepareRecorder().then(()=>this.startRecording())})}})}startRecording(){this.store.recordingInProgress(),this.recognizer.startContinuousRecognitionAsync(()=>{this.recognizer.internalData.privConnectionPromise.__zone_symbol__state===!0&&this.store.recordingStarted(),this.recognizingStatus.set(!0)})}stopRecording(){this.recognizer.stopContinuousRecognitionAsync(()=>{this.store.recordingStopped()})}toggleRecording(){this.store.isRecordingLoading()||(this.store.isRecordingStarted()?this.acceptText():this.startRecording())}acceptText(){this.accept$.next()}rejectText(){this.recognizingText.set(""),this.recognizedText.set(""),this.recognizing$.emit(""),this.recognizingStatus.set(!1),this.stopRecording()}goToEndOfChat(){setTimeout(()=>{let e=this.overlayChatComponent().container().nativeElement.querySelectorAll(".user");e[e.length-1].scrollIntoView(!0)},100)}listenToAccept(){this.accept$.pipe(J(()=>this.recognizedText())).pipe(X(e=>!!e)).pipe(U(this.destroy$)).pipe(S(()=>{this.recognizedText.set(""),this.recognizingText.set(""),this.recognizingStatus.set(!1),this.recognizing$.emit(""),this.stopRecording()})).pipe(S(()=>this.goToEndOfChat())).pipe(ie(e=>this.chatService.sendMessage(e,this.chatService.botNameCtrl.value))).pipe(te(200)).subscribe(()=>{let e=this.overlayChatComponent().container().nativeElement.querySelectorAll(".assistant"),r=setInterval(()=>e[e.length-1].scrollIntoView(!1),200),t=me(()=>{this.overlayChatComponent().animationStatus()||(clearInterval(r),t.destroy())},{injector:this.injector})})}clearChat(){this.chatService.messages.set([])}interruptAvatar(){this.avatarService.interruptAvatar().pipe(B(1)).subscribe()}static \u0275fac=(()=>{let e;return function(t){return(e||(e=z(i)))(t||i)}})();static \u0275cmp=b({type:i,selectors:[["app-screen-control"]],inputs:{overlayChatComponent:[1,"overlayChatComponent"],waves:[1,"waves"]},outputs:{recognizing$:"recognizing$"},standalone:!0,features:[I,T],decls:18,vars:16,consts:[[1,"relative","h-16","flex","justify-center","items-center","gap-2"],[1,"relative","h-full","w-16"],["matTooltipPosition","before","appButton","","shape","pill",1,"!p-1","!absolute","top-1/2","-translate-y-1/2","opacity-0","transition-all","duration-300",3,"click","matTooltip","ngClass"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"w-5","h-5"],["d","M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"],[1,"relative","h-full","!w-16","flex","flex-col","items-center","justify-center","bg-secondary-100","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"!w-16","h-full","flex","flex-col","items-center","justify-center","bg-secondary-100","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"relative","size-6"],["alt","start",1,"w-full","h-full",3,"src"],["alt","start",1,"absolute","top-0","left-0","w-full","h-full","opacity-60",3,"src"],["alt","start",1,"size-6",3,"src"],[3,"color","borderWidth","width"],[1,"size-6",3,"innerHTML"]],template:function(r,t){r&1&&(o(0,"div",0)(1,"div",1)(2,"button",2),h("click",function(){return t.rejectText()}),oe(),o(3,"svg",3),p(4,"path",4),s()(),ae(),o(5,"button",5),h("click",function(){return t.toggleRecording()}),y(6,Oe,3,4)(7,Be,3,2)(8,Ue,3,2)(9,qe,4,5),s()(),o(10,"button",6),h("click",function(){return t.interruptAvatar()}),o(11,"span",7),p(12,"img",8)(13,"img",9),s(),d(14),s(),o(15,"button",6),h("click",function(){return t.clearChat()}),p(16,"img",10),d(17),s()()),r&2&&(n(2),a("matTooltip",t.lang.locals.cancel_recording)("ngClass",C(14,$e,t.store.isRecordingStarted())),n(3),a("disabled",t.store.isRecordingLoading()||t.recognizingStatus()),n(),g(t.store.isRecordingLoading()?6:-1),n(),g(t.store.isRecordingStopped()?7:-1),n(),g(t.store.isRecordingStarted()&&t.recognizingStatus()?8:-1),n(),g(t.store.isRecordingStarted()&&!t.recognizingStatus()?9:-1),n(),a("disabled",!t.store.isStreamStarted()),n(2),a("src","assets/icons/speak.png",_),n(),a("src","assets/icons/stop.png",_),n(),v(" ",t.lang.locals.stop_talking," "),n(),a("disabled",!t.chatService.messages().length),n(),a("src","assets/icons/clear-chat.png",_),n(),v(" ",t.lang.locals.clear_chat_history," "))},dependencies:[k,Te,E,Le,Ie,F]})};var Y=i=>({hidden:i}),He=i=>({"!justify-end":i});function We(i,e){if(i&1&&(o(0,"span",14),d(1),s()),i&2){let r=u();n(),f(r.text())}}function Ge(i,e){i&1&&(o(0,"div",16)(1,"div",18),p(2,"div")(3,"div")(4,"div")(5,"div"),s()())}function Qe(i,e){if(i&1){let r=G();o(0,"div",17)(1,"div",19)(2,"span",20),d(3),s(),p(4,"input",21),o(5,"button",22),h("click",function(){q(r);let c=u();return H(c.saveStreamId())}),d(6),s()()()}if(i&2){let r=u();n(3),v("",r.lang.locals.scan_qr,":"),n(),a("formControl",r.streamId),n(),a("disabled",r.streamId.invalid),n(),v(" ",r.lang.locals.save," ")}}var Z=class i extends D(class{}){_route=l(he);_router=l(fe);_location=l(ue);_avatarService=l(N);store=l(M);lang=l(R);chatService=l(j);streamId=new we("",[xe.required]);isLoading=!1;text=x("");ngAfterViewInit(){this.streamId.setValue(this._route.snapshot.queryParamMap.get("streamId")),this.store.updateStreamId(this.streamId.value??""),this._checkStreamId().subscribe(),this._checkStreamRecursivley().subscribe()}_checkStreamId(e=!0){return this.store.hasStream()?(e&&(this.isLoading=!0),this._avatarService.checkStreamStatus().pipe(ne(()=>this.isLoading=!1),ee(()=>(this._clearStreamId(),O(null))))):O(null)}_checkStreamRecursivley(){return this._checkStreamId(!1).pipe(re(()=>K(6e4).pipe(S(()=>this._checkStreamRecursivley().subscribe()))))}_clearStreamId(){this.store.updateStreamId("");let e=this._router.parseUrl(this._router.url);e.queryParams={},this._location.replaceState(e.toString())}saveStreamId(){this.store.updateStreamId(this.streamId.value??"");let e=this._router.parseUrl(this._router.url);e.queryParams=this.streamId.value?{streamId:this.streamId.value}:{},this._location.replaceState(e.toString()),this._checkStreamId().subscribe()}recognizing(e){this.text.set(e)}static \u0275fac=(()=>{let e;return function(t){return(e||(e=z(i)))(t||i)}})();static \u0275cmp=b({type:i,selectors:[["app-control"]],standalone:!0,features:[I,T],decls:19,vars:17,consts:[["waves",""],["overlayChatComponent",""],[1,"w-full","h-full","px-4","bg-secondary-100/80","rounded-xl","flex","justify-center","items-center","gap-12"],[1,"w-full","md:w-[500px]","h-full","flex","flex-col","justify-between","items-center"],[1,"py-4","relative","max-w-[250px]","text-2xl","text-accent","font-light","flex","justify-center","items-center","gap-4"],["src","assets/icons/login-sparkles.svg","alt","login-sparkles",1,"w-12","h-16"],[1,"h-full","w-full","py-2","flex","flex-col","justify-between","items-center","gap-1","bg-accent/90","rounded-t-3xl"],[1,"w-36","h-6"],[1,"w-full","h-full","overflow-hidden","transition-all","rounded-full","border","border-white","border-white/30",3,"ngClass"],[1,"w-full","pointer-events-none","h-full","opacity-90"],[1,"h-full","max-h-[300px]","w-full","flex","flex-col","items-center","justify-center",3,"ngClass"],[1,"w-full","max-h-full",3,"ngClass"],["src","assets/images/messages.png","alt","messages",1,"w-full","md:w-[300px]",3,"ngClass"],[1,"h-4","w-full","flex","items-center","justify-center"],[1,"flex","items-center","justify-center","bg-black/70","text-white","text-xs","rounded","px-2"],[3,"recognizing$","overlayChatComponent","waves"],[1,"absolute","left-0","top-0","w-full","h-full","z-50","flex","items-center","justify-center","bg-black/60","overflow-hidden","ltr:rounded-tl-xl","rtl:rounded-tr-xl"],[1,"absolute","left-0","top-0","w-full","h-full","z-50","flex","items-center","justify-center","bg-black/80","overflow-hidden","ltr:rounded-tl-xl","rtl:rounded-tr-xl"],[1,"lds-ellipsis"],[1,"flex","flex-col","items-center","justify-center","gap-4"],[1,"max-w-[700px]","font-bold","text-white","text-3xl"],["placeholder","Stream ID*","dir","ltr",1,"rounded-md","p-3","w-full","text-xl","border-2","border-accent-300","placeholder-accent-300","text-accent","outline-none","focus:border-accent","transition-colors",3,"formControl"],["appButton","","color","accent","size","2xl",1,"w-full",3,"click","disabled"]],template:function(r,t){if(r&1){let c=G();o(0,"div",2)(1,"div",3)(2,"div",4),p(3,"img",5),d(4),s(),o(5,"div",6)(6,"div",7)(7,"div",8),p(8,"div",9,0),s()(),o(10,"div",10),p(11,"app-overlay-chat",11,1)(13,"img",12),s(),o(14,"div",13),y(15,We,2,1,"span",14),s(),o(16,"app-screen-control",15),h("recognizing$",function(De){return q(c),H(t.recognizing(De))}),s()()()(),y(17,Ge,6,0,"div",16)(18,Qe,7,4,"div",17)}if(r&2){let c=Q(9),w=Q(12);n(4),v(" ",t.lang.locals.login_greeting_message," "),n(3),a("ngClass",C(9,Y,!t.store.isRecordingStarted())),n(3),a("ngClass",C(11,He,t.chatService.messages().length)),n(),a("ngClass",C(13,Y,!t.chatService.messages().length)),n(2),a("ngClass",C(15,Y,t.chatService.messages().length)),n(2),g(t.text()?15:-1),n(),a("overlayChatComponent",w)("waves",c),n(),g(t.isLoading?17:t.store.hasStream()?-1:18)}},dependencies:[ge,k,je,V,E,_e,ye,be,F],data:{animation:[ve("recordButton",[A("InProgress",L({transform:"scale(1)",backgroundColor:"gray"})),A("Started",L({transform:"scale(1)"})),A("Stopped",L({transform:"scale(0)"})),Se("* <=> *",[Ce("150ms ease-in-out")])])]}})};export{Z as default};
