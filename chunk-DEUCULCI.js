import{b as u}from"./chunk-LQAATZVK.js";import{a as m}from"./chunk-JZHZ6J63.js";import{a as R,b as l,c as N,d,f as a}from"./chunk-6RRUKESK.js";import{K as c,a as i,ea as h,ha as o,ka as n,qa as s,x as S}from"./chunk-UVO63754.js";var A=new N(()=>!1);var I={VERSION:"v0.0.26",BASE_ENVIRONMENT:"",ENVIRONMENTS_URLS:{},BASE_URL:"",API_VERSION:"v1",KUNA_DEV:"",KUNA_STG:"",KUNA_PROD:"",EXTERNAL_PROTOCOLS:["http","https"],IDLE_AVATARS:[]};var p=class e{http=s(a);CONFIG=I;BASE_URL="";load(){return this.http.get("resources/environment.json").pipe(o(t=>this.CONFIG=i(i({},this.CONFIG),t))).pipe(o(()=>this.prepareBaseUrl()))}prepareBaseUrl(){if(!Object.prototype.hasOwnProperty.call(this.CONFIG,"ENVIRONMENTS_URLS")||!Object.keys(this.CONFIG.ENVIRONMENTS_URLS).length)throw Error("There is no ENVIRONMENTS_URLS Property or empty provided inside resources/environment.json file Kindly check it");if(typeof this.CONFIG.BASE_ENVIRONMENT>"u")throw Error("there is no BASE_ENVIRONMENT_INDEX provided inside resources/environment.json file");if(typeof this.CONFIG.ENVIRONMENTS_URLS[this.CONFIG.BASE_ENVIRONMENT]>"u")throw Error("the provided BASE_ENVIRONMENT not exists inside ENVIRONMENTS_URLS array in resources/environment.json file");return this.BASE_URL=this.CONFIG.ENVIRONMENTS_URLS[this.CONFIG.BASE_ENVIRONMENT],Object.prototype.hasOwnProperty.call(this.CONFIG,"API_VERSION")&&this.CONFIG.API_VERSION&&(this.BASE_URL.lastIndexOf("/")!==this.BASE_URL.length-1&&(this.BASE_URL+="/"),this.BASE_URL+=this.CONFIG.API_VERSION),this.BASE_URL}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})};var E=class e{urlService=s(m);http=s(a);store=s(u);config=s(p);constructor(){this.store.idleAvatar()||this.store.updateIdleAvatar(this.config.CONFIG.IDLE_AVATARS[0])}startStream(t){return this.http.post(this.urlService.URLS.AVATAR+"/start-stream",{},{params:i({},t?{size:"life-size"}:void 0)}).pipe(o(r=>this.store.updateStreamId(r.data.id)))}closeStream(){let t=this.store.streamId();return this.store.updateStreamId(""),this.http.delete(this.urlService.URLS.AVATAR+`/close-stream/${t}`)}retrieveStream(){return this.http.get(this.urlService.URLS.AVATAR+`/retrieve-stream/${this.store.streamId()}`)}checkStreamStatus(){return this.http.get(this.urlService.URLS.AVATAR+`/stream-status/${this.store.streamId()}`)}sendCandidate(t){return this.http.post(this.urlService.URLS.AVATAR+`/send-candidate/${this.store.streamId()}`,{candidate:t})}sendAnswer(t){return this.http.put(this.urlService.URLS.AVATAR+`/send-answer/${this.store.streamId()}`,{answer:t})}interruptAvatar(){return this.http.delete(this.urlService.URLS.AVATAR+`/stop-render/${this.store.streamId()}`)}renderText(t){return this.http.post(this.urlService.URLS.AVATAR+`/render-text/${this.store.streamId()}`,{text:t})}updateVideo(t){return this.http.post(this.urlService.URLS.AVATAR+"/update-video",{},{params:{text:t}})}retrieveVideo(){return this.http.get(this.urlService.URLS.AVATAR+"/retrieve-video").pipe(h(t=>t.status==="RENDERING"?c(5e3).pipe(h(()=>this.retrieveVideo())):S(t.data)))}greeting(t,r){let f=`${this.urlService.URLS.AVATAR}/greeting/${t}/${this.store.streamId()}`,O=new l().append("is_ar",r);return this.http.post(f,null,{params:O})}getMSICEServerInfo(){return this.http.get(`https://${this.store.speechToken.region()}.tts.speech.microsoft.com/cognitiveservices/avatar/relay/token/v1`,{context:new d().set(A,!0),headers:new R().set("Authorization",`Bearer ${this.store.speechToken.token()}`)})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})};export{p as a,A as b,E as c};
