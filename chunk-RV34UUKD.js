import{a as j}from"./chunk-I6674MYI.js";import{a as I}from"./chunk-IA6SH5H3.js";import{b as F}from"./chunk-LQAATZVK.js";import{a as H}from"./chunk-6BC4QFZY.js";import{b as E}from"./chunk-46G4OXLF.js";import{b as $}from"./chunk-JZHZ6J63.js";import{Dc as V,Ea as _,Fa as C,Fb as b,Fc as P,Ga as m,Ha as R,Ia as v,Kb as w,Ob as f,Qa as u,T as S,Tb as k,Yb as s,Zb as d,_b as h,cc as M,f as O,fc as z,hc as x,i as c,ld as D,ob as g,qa as l,ua as y,vc as T,wc as A,zb as p}from"./chunk-UVO63754.js";var o=O(j());var B=i=>({"bounce-animation":i});function N(i,e){if(i&1){let t=M();s(0,"button",6),z("click",function(){_(t);let a=x();return C(a.stopRecording())}),m(),s(1,"svg",7),h(2,"path",8),d(),R(),s(3,"span"),T(4),d()()}if(i&2){let t=x();g(4),A(t.lang.locals.cancel_recording)}}var Z=class i extends H(class{}){lang=l($);store=l(F);recognizingStatus=p(!1);recognizingText=p("");recognizedText=p("");recognizing$=u();recognized$=u();speechService=l(I);toggleRecording(){return c(this,null,function*(){if(this.store.isRecordingLoading())return;if(!(yield this.checkMicrophonePermission())){alert("Microphone permission is not granted. Please enable it and try again.");return}this.store.isRecordingStarted()&&this.recognizer?yield this.stopRecording():yield this.startRecording()})}checkMicrophonePermission(){return c(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(t=>t.stop()),!0}catch(e){return console.error("Microphone access denied:",e),!1}})}stopRecording(){return c(this,null,function*(){this.recognizer?this.recognizer.stopContinuousRecognitionAsync(()=>{this.store.recordingStopped(),this.cleartext()}):this.store.recordingStopped()})}startRecording(){return c(this,null,function*(){this.recognizer||(yield this.prepareRecognizer());try{if(!(yield this.checkMicrophonePermission())){this.store.recordingStopped();return}this.store.recordingInProgress(),this.recognizer.startContinuousRecognitionAsync(()=>{this.recognizer.internalData.privConnectionPromise.__zone_symbol__state===!0&&this.store.recordingStarted(),this.recognizingStatus.set(!0)},t=>{console.error("Error starting recognition:",t),this.store.recordingStopped()})}catch(e){console.error("Error starting recording:",e),this.store.recordingStopped()}})}prepareRecognizer(){return c(this,null,function*(){let e=o.AudioConfig.fromDefaultMicrophoneInput(),t=o.AutoDetectSourceLanguageConfig.fromLanguages(["ar-QA","en-US","fr-FR","fr-CA"]),r=o.SpeechConfig.fromAuthorizationToken(this.store.speechToken.token(),this.store.speechToken.region());r.authorizationToken=this.store.speechToken.token(),this.recognizer=o.SpeechRecognizer.FromConfig(r,t,e),this.recognizer.recognizing=(a,n)=>{n.result.reason===o.ResultReason.RecognizingSpeech&&(this.recognizingText.set(this.recognizedText()+" "+n.result.text),this.recognizing$.emit(this.recognizingText()),this.recognizingStatus.set(!0))},this.recognizer.recognized=(a,n)=>{n.result.reason===o.ResultReason.RecognizedSpeech&&this.store.isRecordingStarted()&&(this.recognizedText.update(L=>L+" "+n.result.text),this.recognized$.emit(this.recognizedText()),this.recognizingStatus.set(!1))},this.recognizer.canceled=(a,n)=>{console.error(`Canceled: ${n.reason}`),console.error(`Error Details: ${n.errorDetails}`),this.store.recordingInProgress(),this.speechService.generateSpeechToken().pipe(S(1)).subscribe(()=>{this.prepareRecognizer().then(()=>this.startRecording())})},this.store.recordingStopped()})}cleartext(){this.recognizedText.set(""),this.recognizingText.set("")}static \u0275fac=(()=>{let e;return function(r){return(e||(e=v(i)))(r||i)}})();static \u0275cmp=y({type:i,selectors:[["app-recorder"]],outputs:{recognizing$:"recognizing$",recognized$:"recognized$"},standalone:!0,features:[b,V],decls:6,vars:6,consts:[[1,"relative"],[1,"absolute","flex","rtl:-left-1/2","ltr:-right-1/2","gap-1","items-center","justify-center","bg-black/50","text-xs","opacity-50","hover:opacity-100","text-white","rounded-full","w-max","p-2","-top-2","-translate-y-full"],[1,"rounded-full","bg-white","relative","text-primary","hover:bg-gray-200","shadow","shadow-primary","overflow-hidden","border","flex-shrink-0","flex-grow-0","flex","items-center","justify-center","outline-none","ring-offset-1","focus:ring-2","ring-primary","size-12",3,"click","matTooltip","disabled"],[1,"absolute","bg-primary/60","top-0","left-0","size-full","z-10","rounded-full","scale-0",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","fill","currentColor","viewBox","0 0 256 256",1,"size-8"],["d","M128,176a48.05,48.05,0,0,0,48-48V64a48,48,0,0,0-96,0v64A48.05,48.05,0,0,0,128,176ZM96,64a32,32,0,0,1,64,0v64a32,32,0,0,1-64,0Zm40,143.6V240a8,8,0,0,1-16,0V207.6A80.11,80.11,0,0,1,48,128a8,8,0,0,1,16,0,64,64,0,0,0,128,0,8,8,0,0,1,16,0A80.11,80.11,0,0,1,136,207.6Z"],[1,"absolute","flex","rtl:-left-1/2","ltr:-right-1/2","gap-1","items-center","justify-center","bg-black/50","text-xs","opacity-50","hover:opacity-100","text-white","rounded-full","w-max","p-2","-top-2","-translate-y-full",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","currentColor","viewBox","0 0 256 256",1,"size-3"],["d","M200,32H160a16,16,0,0,0-16,16V208a16,16,0,0,0,16,16h40a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm0,176H160V48h40ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Zm0,176H56V48H96Z"]],template:function(t,r){t&1&&(s(0,"div",0),w(1,N,5,1,"button",1),s(2,"button",2),z("click",function(){return r.toggleRecording()}),h(3,"div",3),m(),s(4,"svg",4),h(5,"path",5),d()()()),t&2&&(g(),k(r.store.isRecordingStarted()?1:-1),g(),f("matTooltip",r.lang.locals.click_to_speak)("disabled",r.store.isRecordingLoading()),g(),f("ngClass",P(4,B,r.store.isRecordingStarted())))},dependencies:[D,E],styles:["[_nghost-%COMP%]{display:contents}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:scale(1)}20%{transform:scale(.6)}40%{transform:scale(.75)}60%{transform:scale(.4)}80%{transform:scale(.25)}}.bounce-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce .8s linear infinite}"]})};export{Z as a};
