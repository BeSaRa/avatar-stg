import{b as v}from"./chunk-6STCOJXD.js";import{a as y}from"./chunk-JTTZ5JU3.js";import{d as b,e as T}from"./chunk-QVKAK5EM.js";import{a as d,b as h,n as f}from"./chunk-XS2U3F55.js";import{d as g}from"./chunk-IBZOQCW6.js";import{B as l,P as m,W as p,a as c,ha as u,ka as C,qa as n,zb as i}from"./chunk-3MLM6FP2.js";function M(o){return class extends o{clone(s){let a=this.constructor;return Object.assign(new a,this,s)}}}var e=class extends M(y){constructor(s="",a="user"){super();this.content=s;this.role=a}end_turn;function_call;tool_calls};var x=class o{http=n(g);urlService=n(d);store=n(v);lang=n(h);messages=i([]);status=i(!1);conversationId=i("");sendMessage(r,s){let a=`${this.urlService.URLS.CHAT}/${s}`;return this.messages.update(t=>[...t,new e(r,"user")]),this.http.post(a,c(c({messages:this.messages()},this.store.streamId()?{stream_id:this.store.streamId()}:null),this.conversationId()?{conversation_id:this.conversationId()}:null)).pipe(m(t=>{throw new e().clone({content:t.message,role:"error"}),new Error(t)})).pipe(l(t=>(t.message.content=b(T(t.message.content,t.message)),t.message=new e().clone(t.message),this.conversationId.set(t.message.conversation_id),this.messages.update(I=>[...I,t.message]),t)))}botNameCtrl=new f("",{nonNullable:!0});onBotNameChange(){return this.botNameCtrl.valueChanges.pipe(p(),u(()=>{this.conversationId.set(""),this.messages.set([])}))}checkInteractivity(){!this.store.isInteracted()&&this.status()&&setTimeout(()=>{this.messages.update(r=>[...r,new e(this.lang.locals.bot_welcom_message,"assistant")]),this.store.updateInteractioinWithChat(!0)})}static \u0275fac=function(s){return new(s||o)};static \u0275prov=C({token:o,factory:o.\u0275fac,providedIn:"root"})};export{x as a};
